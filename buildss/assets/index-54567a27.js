import{ah as T,ai as W,aj as q,ak as G,a as v,j as e,a6 as K,r as x,L as B,al as V}from"./index-b009c0ac.js";import{r as Q,s as U,v as J,t as X,N as Y,w as Z,H as ee,x as D,I as ae,y as te,F as se,z as F,C as ne,R as j,B as N,E as re,h as le,G as ie}from"./Views-3aa30f3b.js";import{C as oe,A as ce}from"./ConfirmDialog-ac6f9f6d.js";import{D as de}from"./DataTable-1ce7dae1.js";import{u as me}from"./useThemeClass-c7400041.js";import{I as ue}from"./index-3c1a1a0d.js";import{A as pe}from"./index-7729926c.js";import{a as xe}from"./formatDate-07229bbd.js";import{d as he}from"./debounce-4e92db93.js";import{F as ge,a as ke,b as S}from"./formik.esm-e4f7a6c1.js";const I="proyekList",b=T(I+"/getProyeks",async t=>{const a=await Q(t);return{data:a.data,total:a.data.totaldataProject,totalPage:a.data.totalPage}}),w=T(I+"/getKliens",async t=>{const a=await U(t);return{data:a.data.data,total:a.data.totaldataClient,totalPage:a.data.totalPage}}),fe=async t=>(await J(t)).data,je={total:0,pageIndex:1,pageSize:10,query:"",filterData:{order:"",progress:0}},ye={loading:!1,kliensLoading:!1,deleteConfirmation:!1,selectedProyek:"",proyekList:[],kliensList:[],tableData:je,filterData:{order:null,progress:null}},z=W({name:`${I}/state`,initialState:ye,reducers:{updateProyekList:(t,a)=>{t.proyekList=a.payload},updateKliensList:(t,a)=>{t.kliensList=a.payload},setTableData:(t,a)=>{t.tableData=a.payload},setFilterData:(t,a)=>{t.filterData=a.payload},toggleDeleteConfirmation:(t,a)=>{t.deleteConfirmation=a.payload},setSelectedProyek:(t,a)=>{t.selectedProyek=a.payload}},extraReducers:t=>{t.addCase(b.fulfilled,(a,l)=>{a.proyekList=l.payload.data,a.tableData.total=l.payload.data.totaldataProject,a.tableData.totalPage=l.payload.data.totalPage,a.loading=!1}).addCase(b.pending,a=>{a.loading=!0}).addCase(w.fulfilled,(a,l)=>{a.kliensList=l.payload.data,a.kliensLoading=!1}).addCase(w.pending,a=>{a.kliensLoading=!0})}}),{updateProyekList:We,setTableData:C,setFilterData:be,toggleDeleteConfirmation:R,setSelectedProyek:ve,updateKliensList:qe}=z.actions,De=z.reducer,Ce=q({data:De}),h=G,Ne=()=>{const t=v(),a=h(r=>r.proyekList.data.deleteConfirmation),l=h(r=>r.proyekList.data.selectedProyek),c=h(r=>r.proyekList.data.tableData),i=()=>{t(R(!1))},m=async()=>{t(R(!1)),await fe({id:l})&&(t(b(c)),X.push(e.jsx(Y,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(oe,{isOpen:a,type:"danger",title:"Hapus Proyek",confirmButtonColor:"red-600",onClose:i,onRequestClose:i,onCancel:i,onConfirm:m,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus faktur pajak ini?"})})},we=({row:t})=>{const a=v(),{textTheme:l}=me(),c=K(),i=r=>{r.stopPropagation(),c(`/manajemen-proyek-edit/${t.id}`)},m=r=>{r.stopPropagation(),a(R(!0)),a(ve(t.id))};return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${l}`,onClick:r=>i(r),children:e.jsx(Z,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:r=>m(r),children:e.jsx(ee,{})})]})},Le=()=>{const t=K(),a=x.useRef(null),l=v(),{pageIndex:c,pageSize:i,sort:m,query:r,total:o}=h(s=>s.proyekList.data.tableData),d=h(s=>s.proyekList.data.filterData),g=h(s=>s.proyekList.data.loading),p=h(s=>s.proyekList.data.proyekList),k=h(s=>s.proyekList.data.kliensList),L=s=>{t(`/manajemen-proyek-detail/${s.id}`)},f=x.useMemo(()=>{var s;return!p.data||!Array.isArray(p.data)?[]:(s=p.data)==null?void 0:s.map(n=>{const u=k.find(P=>P.id===n.idKlien);return{...n,klien:u?u.nama:"Klien Tidak Ditemukan"}})},[p,k]);x.useEffect(()=>{_(),l(w())},[c,i,m,d]),x.useEffect(()=>{var s;a&&((s=a.current)==null||s.resetSorting())},[d]);const y=x.useMemo(()=>({pageIndex:c,pageSize:i,sort:m,query:r,total:o}),[c,i,m,r,o]),_=()=>{l(b({page:c,limit:i,query:r,filterData:d}))},$=x.useMemo(()=>[{header:"Pekerjaan",accessorKey:"pekerjaan",row:100,minWidth:350,cell:s=>{const n=s.row.original;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"text-blue-600 text-xs font-semibold capitalize",children:n.client}),e.jsx("div",{className:"text-base font-medium text-neutral-800 ",children:n.pekerjaan}),e.jsx("div",{className:"text-blue-600 text-xs font-semibold",children:n.pic})]})}},{header:"Nomor Kontrak",accessorKey:"nomor_kontrak",minWidth:200,cell:s=>{const n=s.row.original;return e.jsx("div",{children:n.nomor_kontrak||n.tanggal_kontrak?e.jsxs(e.Fragment,{children:[n.nomor_kontrak&&e.jsx("div",{className:"capitalize mb-1",children:n.nomor_kontrak}),n.tanggal_kontrak&&e.jsx("div",{className:"bg-blue-600 text-xs rounded-md px-3 py-[3px] text-center text-white w-fit",children:xe(n.tanggal_kontrak)})]}):e.jsx("div",{children:"-"})})}},{header:"Lokasi",accessorKey:"lokasi",minWidth:200,cell:s=>{const n=s.row.original;return e.jsx("div",{className:"flex flex-col gap-1",children:n.Lokasis&&n.Lokasis.length>0?n.Lokasis.map((u,P)=>e.jsx("a",{href:`https://www.google.com/maps?q=${u.latitude},${u.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"group",onClick:M=>M.stopPropagation(),children:e.jsxs("div",{className:"text-sm font-medium flex gap-1 items-center group-hover:text-blue-600 transition",children:[e.jsx("div",{className:"text-lg group-hover:scale-110 transition",children:e.jsx(ue,{className:"group-hover:text-blue-600 transition"})}),e.jsx("div",{className:"text-blue-600",children:u.lokasi})]})},P)):e.jsx("span",{children:"-"})})}},{header:"Nilai Kontrak",accessorKey:"nilai_kontrak",minWidth:200,cell:s=>{const n=s.row.original;let u="text-yellow-600";return n.realisasi===0?u="text-red-500":n.realisasi===n.nilai_kontrak&&(u="text-green-500"),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-neutral-700",children:["Rp ",n.nilai_kontrak.toLocaleString("id-ID")]}),e.jsxs("div",{className:`text-xs font-semibold ${u} gap-1 flex items-center`,children:[e.jsx("div",{className:"text-lg",children:e.jsx(pe,{className:"group-hover:text-blue-600 transition"})}),e.jsxs("span",{children:["Rp ",n.realisasi.toLocaleString("id-ID")]})]})]})}},{header:"Progress",accessorKey:"progress",minWidth:150,cell:s=>{const u=s.row.original.progress||0;return e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#a8e6d5",strokeWidth:"15"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#3cbfa6",strokeWidth:"15",strokeDasharray:`${u*2.51} 251`,strokeDashoffset:"0",transform:"rotate(-90 50 50)"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-teal-500",children:[u,"%"]})})]})})}},{header:"Status",accessorKey:"status",cell:s=>{const n=s.row.original;return e.jsx("span",{className:"capitalize",children:n.status})}},{header:"",id:"action",cell:s=>e.jsx(we,{row:s.row.original})}],[]),E=s=>{const n=D(y);n.pageIndex=s,l(C(n))},O=s=>{const n=D(y);n.pageSize=Number(s),n.pageIndex=1,l(C(n))},H=s=>{const n=D(y);n.sort=s,l(C(n))};return e.jsxs(e.Fragment,{children:[e.jsx(de,{ref:a,columns:$,data:f,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:g,pagingData:{total:y.total,pageIndex:y.pageIndex,pageSize:y.pageSize},onPaginationChange:E,onSelectChange:O,onSort:H,onRowClick:L}),e.jsx(Ne,{})]})},Pe=()=>{const t=v(),a=x.useRef(null),l=h(o=>o.proyekList.data.tableData),c=he(i,500);function i(o){const d=D(l);d.query=o,d.pageIndex=1,typeof o=="string"&&o.length>1&&m(d),typeof o=="string"&&o.length===0&&m(d)}const m=o=>{t(C(o)),t(b(o))},r=o=>{c(o.target.value)};return e.jsx(ae,{ref:a,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari proyek",prefix:e.jsx(te,{className:"text-lg"}),onChange:r})},A=x.forwardRef(({onSubmitComplete:t},a)=>{const l=v(),c=h(r=>r.proyekList.data.kliensList),i=h(r=>r.proyekList.data.filterData),m=r=>{t==null||t(),l(be(r))};return x.useEffect(()=>{l(w())},[]),e.jsx(ge,{enableReinitialize:!0,innerRef:a,initialValues:i,onSubmit:r=>{m(r)},children:({values:r,touched:o,errors:d})=>e.jsx(ke,{children:e.jsxs(se,{children:[e.jsx(F,{label:"Klien",invalid:d.idClient&&o.idClient,errorMessage:d.idClient,children:e.jsx(S,{name:"idClient",children:({field:g,form:p})=>{const k=g.value?c.find(f=>f.id===g.value):null,L=c.map(f=>({value:f.id,label:`${f.nama}`}));return e.jsx(ne,{field:g,form:p,options:L,value:k?{value:k.nama,label:`${k.nama}`}:null,placeholder:"Pilih klien",onChange:f=>{p.setFieldValue(g.name,f==null?void 0:f.value)}})}})}),e.jsxs(F,{invalid:d.progress&&o.progress,errorMessage:d.progress,children:[e.jsx("h6",{className:"mb-4",children:"Progress"}),e.jsx(S,{name:"progress",children:({field:g,form:p})=>e.jsxs(j.Group,{vertical:!0,value:r.progress,onChange:k=>{p.setFieldValue(g.name,k)},children:[e.jsx(j,{value:30,children:"30"}),e.jsx(j,{value:50,children:"50"}),e.jsx(j,{value:95,children:"95"}),e.jsx(j,{value:100,children:"100"})]})})]}),e.jsxs(F,{invalid:d.order&&o.order,errorMessage:d.order,children:[e.jsx("h6",{className:"mb-4",children:"Urutkan"}),e.jsx(S,{name:"order",children:({field:g,form:p})=>e.jsxs(j.Group,{vertical:!0,value:r.order,onChange:k=>{p.setFieldValue(g.name,k)},children:[e.jsx(j,{value:"asc",children:"Ascending"}),e.jsx(j,{value:"desc",children:"Descending"})]})})]})]})})})}),Fe=({onSaveClick:t,onCancel:a})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(N,{size:"sm",className:"mr-2",onClick:a,children:"Cancel"}),e.jsx(N,{size:"sm",variant:"solid",onClick:t,children:"Query"})]}),Se=()=>{const t=x.useRef(null),[a,l]=x.useState(!1),c=()=>{l(!0)},i=()=>{l(!1)},m=()=>{var r;(r=t.current)==null||r.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(re,{}),onClick:()=>c(),children:"Filter"}),e.jsx(le,{title:"Filter",isOpen:a,footer:e.jsx(Fe,{onCancel:i,onSaveClick:m}),onClose:i,onRequestClose:i,children:e.jsx(A,{ref:t,onSubmitComplete:i})})]})};A.displayName="FilterForm";const Re=()=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(Pe,{}),e.jsx(Se,{}),e.jsx(B,{className:"block lg:inline-block md:mb-0 mb-4 md:ml-2",to:"/manajemen-proyek-new",children:e.jsx(N,{block:!0,variant:"solid",size:"sm",icon:e.jsx(ie,{}),children:"Tambah Proyek"})})]});V("proyekList",Ce);const Ie=()=>e.jsxs(ce,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Proyek"}),e.jsx(Re,{})]}),e.jsx(Le,{})]}),Ge=Ie;export{Ge as default};
