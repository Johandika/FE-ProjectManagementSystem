import{ah as c,ai as A,aj as F,al as L,a6 as v,a as G,u as d,r as R,j as i,am as $}from"./index-b009c0ac.js";import{P as M}from"./ProyekForm-c87444dd.js";import{s as T,aA as Y,aB as q,i as z,t as w,N as _,Y as r,aC as H}from"./Views-3aa30f3b.js";import{a as J}from"./SatuanService-190aa774.js";import"./StickyFooter-132dd9b0.js";import"./ConfirmDialog-ac6f9f6d.js";import"./formik.esm-e4f7a6c1.js";import"./react-number-format.es-92e434c6.js";import"./index-7729926c.js";import"./index.esm-0e511974.js";const l="proyekNew",k=c(l+"/getKliens",async()=>(await T()).data),m=c(l+"/getBerkases",async()=>(await Y()).data),g=c(l+"/getSatuans",async()=>(await J()).data),y=c(l+"/getSubkontraktors",async()=>(await q()).data),O={loading:!0,loadingKliens:!0,loadingSatuans:!0,loadingBerkases:!0,loadingSubkontraktors:!0},Q=A({name:`${l}/state`,initialState:O,reducers:{},extraReducers:o=>{o.addCase(k.fulfilled,(a,n)=>{a.kliensData=n.payload,a.loadingKliens=!1}).addCase(k.pending,a=>{a.loadingKliens=!0}).addCase(g.fulfilled,(a,n)=>{a.satuansData=n.payload,a.loadingSatuans=!1}).addCase(g.pending,a=>{a.loadingSatuans=!0}).addCase(m.fulfilled,(a,n)=>{a.berkasesData=n.payload,a.loadingBerkases=!1}).addCase(m.pending,a=>{a.loadingBerkases=!0}).addCase(y.fulfilled,(a,n)=>{a.subkontraktorsData=n.payload,a.loadingSubkontraktors=!1}).addCase(y.pending,a=>{a.loadingSubkontraktors=!0})}}),U=Q.reducer,V=F({data:U});L("proyekNew",V);const W=()=>{const o=v(),a=G(),n=d(e=>{var s;return((s=e.proyekNew.data.kliensData)==null?void 0:s.data)||[]}),f=d(e=>{var s;return((s=e.proyekNew.data.berkasesData)==null?void 0:s.data)||[]}),D=d(e=>{var s;return((s=e.proyekNew.data.subkontraktorsData)==null?void 0:s.data)||[]}),N=d(e=>{var s;return((s=e.proyekNew.data.satuansData)==null?void 0:s.data)||[]}),{loadingBerkases:j,loadingSubkontraktors:x,loadingSatuans:C,loadingKliens:B}=d(e=>e.proyekNew.data),E=async(e,s)=>{var b,h,S;const p={...e,nilai_kontrak:r(e.nilai_kontrak),uang_muka:r(e.uang_muka),persen_retensi:r(e.persen_retensi),item:(b=e.item)==null?void 0:b.map(t=>({...t,detail:t.detail.map(u=>({...u,volume:r(u.volume),harga_satuan_material:r(u.harga_satuan_material),harga_satuan_jasa:r(u.harga_satuan_jasa)}))})),timeline:r(e.timeline),termin:(h=e.termin)==null?void 0:h.map(t=>({...t,persen:r(t.persen)})),subkontraktor:(S=e.subkontraktor)==null?void 0:S.map(t=>({...t,nilai_subkontrak:r(t.nilai_subkontrak)}))};try{return(await H(p)).data}catch(t){t&&(s(!1),w.push(i.jsx(_,{title:"Error Added",type:"danger",duration:2500,children:t.response.data.message}),{placement:"top-center"}))}},K=async(e,s)=>{s(!0);const p=await E(e,s);s(!1),p&&(w.push(i.jsx(_,{title:"Successfuly added",type:"success",duration:2500,children:"Proyek berhasil ditambahkan"}),{placement:"top-center"}),o("/manajemen-proyek"))},P=()=>{o("/manajemen-proyek")};return R.useEffect(()=>{a(k()),a(m()),a(y()),a(g())},[location.pathname]),i.jsx(i.Fragment,{children:i.jsx($,{loading:B||j||x||C,children:!z(n&&f)&&i.jsx(i.Fragment,{children:i.jsx(M,{type:"new",kliensList:n,berkasesList:f,subkontraktorsList:D,satuansList:N,onFormSubmit:K,onDiscard:P})})})})},ia=W;export{ia as default};
