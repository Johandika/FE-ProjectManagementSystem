import{ai as k,aj as L,ak as A,i as G,a7 as R,u as T,a as d,r as U,as as $,j as i,am as z}from"./index-8f324225.js";import{P as M}from"./ProyekForm-2b43f8f8.js";import{z as q,aS as H,aT as J,i as O,t as D,N as w,ad as r,aU as Q}from"./Views-a6cda74e.js";import{a as V}from"./SatuanService-a4bac9a4.js";import"./StickyFooter-e17b8275.js";import"./ConfirmDialog-cacab1ef.js";import"./formik.esm-79e86e67.js";import"./AdaptableCard-54b628e2.js";import"./react-number-format.es-53214375.js";import"./index-7235128c.js";import"./index.esm-02ea902b.js";const l="proyekNew",g=k(l+"/getKliens",async()=>(await q()).data),y=k(l+"/getBerkases",async()=>(await H()).data),f=k(l+"/getSatuans",async()=>(await V()).data),S=k(l+"/getSubkontraktors",async()=>(await J()).data),W={loading:!0,loadingKliens:!0,loadingSatuans:!0,loadingBerkases:!0,loadingSubkontraktors:!0},X=L({name:`${l}/state`,initialState:W,reducers:{},extraReducers:o=>{o.addCase(g.fulfilled,(a,n)=>{a.kliensData=n.payload,a.loadingKliens=!1}).addCase(g.pending,a=>{a.loadingKliens=!0}).addCase(f.fulfilled,(a,n)=>{a.satuansData=n.payload,a.loadingSatuans=!1}).addCase(f.pending,a=>{a.loadingSatuans=!0}).addCase(y.fulfilled,(a,n)=>{a.berkasesData=n.payload,a.loadingBerkases=!1}).addCase(y.pending,a=>{a.loadingBerkases=!0}).addCase(S.fulfilled,(a,n)=>{a.subkontraktorsData=n.payload,a.loadingSubkontraktors=!1}).addCase(S.pending,a=>{a.loadingSubkontraktors=!0})}}),Y=X.reducer,Z=A({data:Y});G("proyekNew",Z);const I=()=>{const o=R(),a=T(),n=d(e=>{var s;return((s=e.proyekNew.data.kliensData)==null?void 0:s.data)||[]}),{selectDivisi:_,loadingSelectDivisi:N}=d(e=>e.base.common),b=d(e=>{var s;return((s=e.proyekNew.data.berkasesData)==null?void 0:s.data)||[]}),j=d(e=>{var s;return((s=e.proyekNew.data.subkontraktorsData)==null?void 0:s.data)||[]}),x=d(e=>{var s;return((s=e.proyekNew.data.satuansData)==null?void 0:s.data)||[]}),{loadingBerkases:C,loadingSubkontraktors:v,loadingSatuans:B,loadingKliens:E}=d(e=>e.proyekNew.data),K=async(e,s)=>{var p,c,h;const m={...e,nilai_kontrak:r(e.nilai_kontrak),uang_muka:r(e.uang_muka),persen_retensi:r(e.persen_retensi),item:(p=e.item)==null?void 0:p.map(t=>({...t,detail:t.detail.map(u=>({...u,volume:r(u.volume),harga_satuan_material:r(u.harga_satuan_material),harga_satuan_jasa:r(u.harga_satuan_jasa)}))})),timeline:r(e.timeline),termin:(c=e.termin)==null?void 0:c.map(t=>({...t,persen:r(t.persen)})),subkontraktor:(h=e.subkontraktor)==null?void 0:h.map(t=>({...t,nilai_subkontrak:r(t.nilai_subkontrak)}))};try{return(await Q(m)).data}catch(t){t&&(s(!1),D.push(i.jsx(w,{title:"Error Added",type:"danger",duration:2500,children:t.response.data.message}),{placement:"top-center"}))}},P=async(e,s)=>{var c;const m={...e,pic:(c=e.pic)==null?void 0:c.toUpperCase()};s(!0);const p=await K(m,s);s(!1),p&&(D.push(i.jsx(w,{title:"Successfuly added",type:"success",duration:2500,children:"Proyek berhasil ditambahkan"}),{placement:"top-center"}),o("/manajemen-proyek/proyek"))},F=()=>{o("/manajemen-proyek/proyek")};return U.useEffect(()=>{a(g()),a(y()),a(S()),a(f()),a($())},[location.pathname]),i.jsx(i.Fragment,{children:i.jsx(z,{loading:E||C||v||B||N,children:!O(n&&b)&&i.jsx(i.Fragment,{children:i.jsx(M,{type:"new",dataDivisi:_.data,kliensList:n,berkasesList:b,subkontraktorsList:j,satuansList:x,onFormSubmit:P,onDiscard:F})})})})},pa=I;export{pa as default};
