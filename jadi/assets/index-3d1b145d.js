import{ai as E,aj as Z,ak as ee,al as ae,u as w,j as e,i as W,a7 as M,r as f,a as te,L as se}from"./index-8f324225.js";import{y as ie,z as ne,C as re,t as z,N as A,E as le,G as oe,I as ce,H as de,B as P,J as K,K as ue,L as me,P as pe,F as L,w as _,R as D,v as xe,k as he,Q as ge}from"./Views-a6cda74e.js";import{A as ke}from"./AdaptableCard-54b628e2.js";import{D as fe}from"./DataTable-66df47f9.js";import{u as je}from"./useThemeClass-fe409b1f.js";import{C as B}from"./ConfirmDialog-cacab1ef.js";import{r as ye,s as be,g as ve}from"./index-ac527888.js";import{I as De}from"./index-2428b262.js";import{A as Ce}from"./index-7235128c.js";import{a as Ne}from"./formatDate-07efb40a.js";import{d as we}from"./debounce-9aa8ee7b.js";import{F as Pe,a as Se,b as F}from"./formik.esm-79e86e67.js";import"./index-fee04496.js";const $="proyekList",N=E($+"/getProyeks",async t=>{const a=await ie(t);return{data:a.data,total:a.data.totaldataProject,totalPage:a.data.totalPage}}),T=E($+"/getKliens",async t=>{const a=await ne(t);return{data:a.data.data,total:a.data.totaldataClient,totalPage:a.data.totalPage}}),Le=async t=>(await re(t)).data,Fe={total:0,pageIndex:1,pageSize:10,query:"",filterData:{order:"",progress:0}},Ke={loading:!1,kliensLoading:!1,deleteConfirmation:!1,updateConfirmation:!1,selectedProyek:"",projectStatus:"",proyekList:[],kliensList:[],tableData:Fe,filterData:{order:null,progress:null}},q=Z({name:`${$}/state`,initialState:Ke,reducers:{updateProyekList:(t,a)=>{t.proyekList=a.payload},updateKliensList:(t,a)=>{t.kliensList=a.payload},setTableData:(t,a)=>{t.tableData=a.payload},setFilterData:(t,a)=>{t.filterData=a.payload},toggleDeleteConfirmation:(t,a)=>{t.deleteConfirmation=a.payload},toggleUpdateConfirmation:(t,a)=>{t.updateConfirmation=a.payload},setSelectedProyek:(t,a)=>{t.selectedProyek=a.payload},setProjectStatus:(t,a)=>{t.projectStatus=a.payload}},extraReducers:t=>{t.addCase(N.fulfilled,(a,r)=>{a.proyekList=r.payload.data,a.tableData.total=r.payload.data.totaldataProject,a.tableData.totalPage=r.payload.data.totalPage,a.loading=!1}).addCase(N.pending,a=>{a.loading=!0}).addCase(T.fulfilled,(a,r)=>{a.kliensList=r.payload.data,a.kliensLoading=!1}).addCase(T.pending,a=>{a.kliensLoading=!0})}}),{updateProyekList:ia,setTableData:R,setFilterData:Re,toggleDeleteConfirmation:I,toggleUpdateConfirmation:O,setSelectedProyek:H,setProjectStatus:Te,updateKliensList:na}=q.actions,ze=q.reducer,Ae=ee({data:ze}),x=ae,Ie=()=>{const t=w(),a=x(o=>o.proyekList.data.deleteConfirmation),r=x(o=>o.proyekList.data.selectedProyek),d=x(o=>o.proyekList.data.tableData),u=()=>{t(I(!1))},m=async()=>{t(I(!1)),await Le({id:r})&&(t(N(d)),z.push(e.jsx(A,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(B,{isOpen:a,type:"danger",title:"Hapus Proyek",confirmButtonColor:"red-600",onClose:u,onRequestClose:u,onCancel:u,onConfirm:m,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus faktur pajak ini?"})})};W("notification",ye);const Oe=()=>{const t=w(),a=x(n=>n.proyekList.data.updateConfirmation),r=x(n=>n.proyekList.data.selectedProyek),d=x(n=>n.proyekList.data.projectStatus),u=x(n=>n.proyekList.data.tableData),m=()=>{t(O(!1))},o=async()=>{t(O(!1));try{let n;d==="Selesai Sudah tertagih 100%"?n=await le({id:r,status:!0}):d==="Belum Dimulai"&&(n=await oe({id:r,status:!0})),n&&(t(be(!0)),t(ve()),t(N(u)),z.push(e.jsx(A,{title:"Successfuly Updated",type:"success",duration:2500,children:"Status berhasil di perbarui"}),{placement:"top-center"}))}catch(n){console.error("Error deleting notification:",n),z.push(e.jsx(A,{title:"Gagal Update Status Proyek",type:"danger",duration:2500,children:n.response.data.message}),{placement:"top-center"})}};return e.jsx(B,{isOpen:a,onClose:m,onRequestClose:m,onCancel:m,type:"warning",title:"Ubah Status",onConfirm:o,children:e.jsx("p",{children:"Apakah kamu yakin ingin mengupdate status proyek ?"})})},$e=({row:t})=>{const a=w(),{textTheme:r}=je(),d=M(),u=o=>{o.stopPropagation(),d(`/manajemen-proyek-edit/${t.id}`)},m=o=>{o.stopPropagation(),a(I(!0)),a(H(t.id))};return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${r}`,onClick:o=>u(o),children:e.jsx(ce,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:o=>m(o),children:e.jsx(de,{})})]})},Ue=()=>{const t=M(),a=f.useRef(null),r=w(),d=x(l=>l.auth.user),{pageIndex:u,pageSize:m,sort:o,query:n,total:v}=x(l=>l.proyekList.data.tableData),p=x(l=>l.proyekList.data.filterData),C=x(l=>l.proyekList.data.loading),k=x(l=>l.proyekList.data.proyekList),h=x(l=>l.proyekList.data.kliensList),y=l=>{t(`/manajemen-proyek-detail/${l.id}`)},j=f.useMemo(()=>{var l;return!k.data||!Array.isArray(k.data)?[]:(l=k.data)==null?void 0:l.map(i=>{const s=h.find(c=>c.id===i.idKlien);return{...i,klien:s?s.nama:"Klien Tidak Ditemukan"}})},[k,h]);f.useEffect(()=>{b(),r(T())},[u,m,o,p]),f.useEffect(()=>{var l;a&&((l=a.current)==null||l.resetSorting())},[p]);const g=f.useMemo(()=>({pageIndex:u,pageSize:m,sort:o,query:n,total:v}),[u,m,o,n,v]),b=()=>{r(N({page:u,limit:m,query:n,filterData:p}))},U=f.useCallback((l,i)=>{l.stopPropagation(),r(O(!0)),r(H(i.id)),r(Te(i.status))},[r]),V=f.useMemo(()=>{const l=[{header:"Pekerjaan",accessorKey:"pekerjaan",row:100,minWidth:350,cell:i=>{const s=i.row.original;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"text-blue-600 text-xs font-semibold capitalize",children:s.client}),e.jsxs("div",{className:"text-base font-medium text-neutral-800",children:[s.idTender&&e.jsx("span",{className:"bg-emerald-100 text-emerald-600 w-[20px] h-[20px] px-[6px] py-[2px]  mr-2 text-xs font-semibold rounded-md",children:"Tender"}),s.pekerjaan]}),e.jsx("div",{className:"text-blue-600 text-xs font-semibold",children:s.pic})]})}},{header:"Nomor Kontrak",accessorKey:"nomor_kontrak",minWidth:200,cell:i=>{const s=i.row.original;return e.jsx("div",{children:s.nomor_kontrak||s.tanggal_kontrak?e.jsxs(e.Fragment,{children:[s.nomor_kontrak&&e.jsx("div",{className:"capitalize mb-1",children:s.nomor_kontrak}),s.tanggal_kontrak&&e.jsx("div",{className:"bg-blue-600 text-xs rounded-md px-3 py-[3px] text-center text-white w-fit",children:Ne(s.tanggal_kontrak)})]}):e.jsx("div",{children:"-"})})}},{header:"Lokasi",accessorKey:"lokasi",minWidth:200,cell:i=>{const s=i.row.original;return e.jsx("div",{className:"flex flex-col gap-1",children:s.Lokasis&&s.Lokasis.length>0?s.Lokasis.map((c,S)=>e.jsx("a",{href:`https://www.google.com/maps?q=${c.latitude},${c.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"group",onClick:Y=>Y.stopPropagation(),children:e.jsxs("div",{className:"text-sm font-medium flex gap-1 items-center group-hover:text-blue-600 transition",children:[e.jsx("div",{className:"text-lg group-hover:scale-110 transition",children:e.jsx(De,{className:"group-hover:text-blue-600 transition"})}),e.jsx("div",{className:"text-blue-600",children:c.lokasi})]})},S)):e.jsx("span",{children:"-"})})}},{header:"Nilai Kontrak",accessorKey:"nilai_kontrak",minWidth:200,cell:i=>{const s=i.row.original;let c="text-yellow-600";return s.realisasi===0?c="text-red-500":s.realisasi===s.nilai_kontrak&&(c="text-green-500"),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-neutral-700",children:["Rp ",s.nilai_kontrak.toLocaleString("id-ID")]}),e.jsxs("div",{className:`text-xs font-semibold ${c} gap-1 flex items-center`,children:[e.jsx("div",{className:"text-lg",children:e.jsx(Ce,{className:"group-hover:text-blue-600 transition"})}),e.jsxs("span",{children:["Rp ",s.realisasi.toLocaleString("id-ID")]})]})]})}},{header:"Progress",accessorKey:"progress",minWidth:150,cell:i=>{const c=i.row.original.progress||0;return e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#a8e6d5",strokeWidth:"15"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"#3cbfa6",strokeWidth:"15",strokeDasharray:`${c*2.51} 251`,strokeDashoffset:"0",transform:"rotate(-90 50 50)"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-teal-500",children:[c,"%"]})})]})})}},{header:"Status",accessorKey:"status",minWidth:160,cell:i=>{const s=i.row.original;return e.jsxs("div",{className:"flex flex-col gap-1",children:[s.status==="Selesai Sudah tertagih 100%"?e.jsx("span",{className:"capitalize text-green-600",children:s.status}):s.status==="Selesai belum tertagih 100%"?e.jsx("span",{className:"capitalize text-yellow-600",children:s.status}):s.status==="Selesai"?e.jsx("span",{className:"capitalize text-emerald-600",children:s.status}):s.status==="Dalam Proses"?e.jsx("span",{className:"capitalize text-blue-600",children:s.status}):e.jsx("span",{className:"capitalize",children:s.status}),(s.status==="Belum Dimulai"||s.status==="Selesai Sudah tertagih 100%")&&e.jsx(P,{size:"xs",variant:"solid",color:s.status==="Belum Dimulai"?"indigo-600":"emerald-500",onClick:c=>U(c,s),children:s.status==="Belum Dimulai"?"Mulai Proyek":"Proyek Selesai"})]})}},{header:"Divisi",accessorKey:"idDivisi",minWidth:180,cell:i=>{var c;const s=i.row.original;return e.jsx("div",{className:"flex flex-col gap-1",children:(c=s.Divisi)==null?void 0:c.name})}},{header:"Dibuat Oleh",accessorKey:"dibuatOleh",minWidth:180,cell:i=>{var c;const s=i.row.original;return e.jsx("div",{className:"flex flex-col gap-1",children:(c=s.User)==null?void 0:c.nama})}},{header:"Keterangan",accessorKey:"keterangan",minWidth:260,cell:i=>{var c,S;const s=i.row.original;return e.jsx("div",{className:"flex flex-col gap-1",children:(c=s.KeteranganProjects[0])!=null&&c.keterangan?(S=s.KeteranganProjects[0])==null?void 0:S.keterangan:s.keterangan})}}];return(d==null?void 0:d.authority)!=="Owner"&&l.push({header:"",id:"action",cell:i=>e.jsx($e,{row:i.row.original})}),l},[d,U]),J=l=>{const i=K(g);i.pageIndex=l,r(R(i))},Q=l=>{const i=K(g);i.pageSize=Number(l),i.pageIndex=1,r(R(i))},X=l=>{const i=K(g);i.sort=l,r(R(i))};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{ref:a,columns:V,data:j,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:C,pagingData:{total:g.total,pageIndex:g.pageIndex,pageSize:g.pageSize},onPaginationChange:J,onSelectChange:Q,onSort:X,onRowClick:y}),e.jsx(Ie,{}),e.jsx(Oe,{})]})},_e=()=>{const t=w(),a=f.useRef(null),r=x(n=>n.proyekList.data.tableData),d=we(u,500);function u(n){const v=K(r);v.query=n,v.pageIndex=1,typeof n=="string"&&n.length>1&&m(v),typeof n=="string"&&n.length===0&&m(v)}const m=n=>{t(R(n)),t(N(n))},o=n=>{d(n.target.value)};return e.jsx(ue,{ref:a,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari proyek",prefix:e.jsx(me,{className:"text-lg"}),onChange:o})},G=f.forwardRef(({onSubmitComplete:t},a)=>{const r=w(),{selectDivisi:d,loadingSelectDivisi:u}=x(p=>p.base.common),m=f.useMemo(()=>d!=null&&d.data?d.data.map(p=>({value:p.id,label:p.name})):[],[d]),o=x(p=>p.proyekList.data.kliensList),n=x(p=>p.proyekList.data.filterData),v=p=>{t==null||t(),r(Re(p))};return f.useEffect(()=>{r(T())},[]),e.jsx(Pe,{enableReinitialize:!0,innerRef:a,initialValues:n,onSubmit:p=>{v(p)},children:({values:p,touched:C,errors:k})=>e.jsx(Se,{children:e.jsxs(pe,{children:[e.jsx(L,{label:"Klien",invalid:k.idClient&&C.idClient,errorMessage:k.idClient,children:e.jsx(F,{name:"idClient",children:({field:h,form:y})=>{const j=h.value?o.find(b=>b.id===h.value):null,g=o.map(b=>({value:b.id,label:`${b.nama}`}));return e.jsx(_,{field:h,form:y,options:g,value:j?{value:j.nama,label:`${j.nama}`}:null,placeholder:"Pilih klien",onChange:b=>{y.setFieldValue(h.name,b==null?void 0:b.value)}})}})}),e.jsx(L,{label:"Klien",invalid:k.idDivisi&&C.idDivisi,errorMessage:k.idDivisi,children:e.jsx(F,{name:"idDivisi",children:({field:h,form:y})=>{const j=h.value?m.find(g=>g.value===h.value):null;return e.jsx(_,{field:h,form:y,options:m,isLoading:u,value:j||null,placeholder:"Pilih divisi",onChange:g=>{y.setFieldValue(h.name,g==null?void 0:g.value)}})}})}),e.jsxs(L,{invalid:k.progress&&C.progress,errorMessage:k.progress,children:[e.jsx("h6",{className:"mb-4",children:"Progress"}),e.jsx(F,{name:"progress",children:({field:h,form:y})=>e.jsxs(D.Group,{vertical:!0,value:p.progress,onChange:j=>{y.setFieldValue(h.name,j)},className:"inline space-x-4 sm:space-x-6",children:[e.jsx(D,{value:30,children:"30"}),e.jsx(D,{value:50,children:"50"}),e.jsx(D,{value:95,children:"95"}),e.jsx(D,{value:100,children:"100"})]})})]}),e.jsxs(L,{invalid:k.order&&C.order,errorMessage:k.order,children:[e.jsx("h6",{className:"mb-4",children:"Urutkan"}),e.jsx(F,{name:"order",children:({field:h,form:y})=>e.jsxs(D.Group,{vertical:!0,value:p.order,onChange:j=>{y.setFieldValue(h.name,j)},children:[e.jsx(D,{value:"asc",children:"Ascending"}),e.jsx(D,{value:"desc",children:"Descending"})]})})]})]})})})}),Ee=({onSaveClick:t,onCancel:a})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(P,{size:"sm",className:"mr-2",onClick:a,children:"Cancel"}),e.jsx(P,{size:"sm",variant:"solid",onClick:t,children:"Terapkkan"})]}),We=()=>{const t=f.useRef(null),[a,r]=f.useState(!1),d=()=>{r(!0)},u=()=>{r(!1)},m=()=>{var o;(o=t.current)==null||o.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(xe,{}),onClick:()=>d(),children:"Filter"}),e.jsx(he,{title:"Filter",isOpen:a,footer:e.jsx(Ee,{onCancel:u,onSaveClick:m}),onClose:u,onRequestClose:u,children:e.jsx(G,{ref:t,onSubmitComplete:u})})]})};G.displayName="FilterForm";const Me=()=>{const t=te(a=>a.auth.user);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(_e,{}),e.jsx(We,{}),t.authority!=="Owner"&&e.jsx(se,{className:"block lg:inline-block md:mb-0 mb-4 md:ml-2",to:"/manajemen-proyek-new",children:e.jsx(P,{block:!0,variant:"solid",size:"sm",icon:e.jsx(ge,{}),children:"Tambah Proyek"})})]})};W("proyekList",Ae);const Be=()=>e.jsxs(ke,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Proyek"}),e.jsx(Me,{})]}),e.jsx(Ue,{})]}),ra=Be;export{ra as default};
