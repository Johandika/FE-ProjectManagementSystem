import{r as p,j as e,am as oe,c as de,u as R,i as re}from"./index-8f324225.js";import{f as U,u as f,i as y,j as W,k as I,s as N,l as K,m as B,r as ce}from"./formatStringRupiah-65f8d9ca.js";import{A as ue}from"./AdaptableCard-54b628e2.js";import{aZ as Q,a_ as me,w as ge,aD as pe,t as q,N as V,a$ as he,b0 as xe,B as $,J as _,K as fe,L as je}from"./Views-a6cda74e.js";import{u as be,f as G,T as Se,g as Ce,a as ke,b as De,c as ve,d as Te}from"./index-fee04496.js";import{a as L}from"./formatDate-07efb40a.js";import{C as ye}from"./ConfirmDialog-cacab1ef.js";import{d as Re}from"./debounce-9aa8ee7b.js";const{Tr:A,Th:we,Td:J,THead:Ae,TBody:Ne,Sorter:_e}=Q,Z=i=>{const{indeterminate:o,onChange:u,onCheckBoxChange:c,onIndeterminateCheckBoxChange:l,...d}=i,m=p.useRef(null);p.useEffect(()=>{typeof o=="boolean"&&m.current&&(m.current.indeterminate=!d.checked&&o)},[m,o]);const t=g=>{u(g),c==null||c(g),l==null||l(g)};return e.jsx(pe,{ref:m,className:"mb-0",onChange:(g,x)=>t(x),...d})};function Le(i,o){const{skeletonAvatarColumns:u,columns:c=[],data:l=[],loading:d=!1,onCheckBoxChange:m,onIndeterminateCheckBoxChange:t,onPaginationChange:g,onSelectChange:x,onSort:S,onRowClick:C,pageSizes:D=[10,25,50,100],selectable:v=!1,skeletonAvatarProps:n,getRowCanExpand:h,pagingData:P={total:0,pageIndex:1,pageSize:10}}=i,{pageSize:w,pageIndex:X,total:Y}=P,[j,ee]=p.useState(null),z=p.useMemo(()=>D.map(a=>({value:a,label:`${a} / page`})),[D]),ae=(a,s)=>{d||m==null||m(a,s)},te=(a,s)=>{d||t==null||t(a,s)},se=a=>{d||g==null||g(a)},ne=a=>{d||x==null||x(Number(a))};p.useEffect(()=>{if(Array.isArray(j)){const a=j.length>0?j[0].desc?"desc":"asc":"",s=j.length>0?j[0].id:"";S==null||S({order:a,key:s})}},[j]);const E=p.useMemo(()=>{const a=c;return v?[{id:"select",header:({table:s})=>e.jsx(Z,{checked:s.getIsAllRowsSelected(),indeterminate:s.getIsSomeRowsSelected(),onChange:s.getToggleAllRowsSelectedHandler(),onIndeterminateCheckBoxChange:b=>{te(b.target.checked,s.getRowModel().rows)}}),cell:({row:s})=>e.jsx(Z,{checked:s.getIsSelected(),disabled:!s.getCanSelect(),indeterminate:s.getIsSomeSelected(),onChange:s.getToggleSelectedHandler(),onCheckBoxChange:b=>ae(b.target.checked,s.original)})},...a]:a},[c,v]),T=be({data:l,getRowCanExpand:h,getExpandedRowModel:Ce(),columns:E,getCoreRowModel:ke(),getFilteredRowModel:De(),getPaginationRowModel:ve(),getSortedRowModel:Te(),manualPagination:!0,manualSorting:!0,onSortingChange:a=>{ee(a)},state:{sorting:j}}),le=()=>{T.resetSorting()},ie=()=>{T.toggleAllRowsSelected(!1)};return p.useImperativeHandle(o,()=>({resetSorting:le,resetSelected:ie})),e.jsxs(oe,{loading:d&&l.length!==0,type:"cover",children:[e.jsxs(Q,{children:[e.jsx(Ae,{children:T.getHeaderGroups().map(a=>e.jsx(A,{children:a.headers.map(s=>e.jsx(we,{colSpan:s.colSpan,style:{width:s.column.columnDef.width,minWidth:s.column.columnDef.minWidth},children:s.isPlaceholder?null:e.jsxs("div",{className:de(s.column.getCanSort()&&"cursor-pointer select-none point",d&&"pointer-events-none"),onClick:s.column.getToggleSortingHandler(),children:[G(s.column.columnDef.header,s.getContext()),s.column.getCanSort()&&e.jsx(_e,{sort:s.column.getIsSorted()})]})},s.id))},a.id))}),d&&l.length===0?e.jsx(Se,{columns:E.length,rows:P.pageSize,avatarInColumns:u,avatarProps:n}):e.jsx(Ne,{children:T.getRowModel().rows.slice(0,w).map(a=>{var s,b,M,H,F,O;return e.jsxs(p.Fragment,{children:[e.jsx(A,{className:C?"cursor-pointer hover:bg-gray-50":"",onClick:()=>C&&C(a.original),children:a.getVisibleCells().map(r=>e.jsx(J,{style:{width:r.column.columnDef.width,minWidth:r.column.columnDef.minWidth},children:G(r.column.columnDef.cell,r.getContext())},r.id))},a.id),a.getIsExpanded()&&e.jsx(A,{children:e.jsxs(J,{colSpan:a.getVisibleCells().length,className:"w-full",children:[((s=a.original)==null?void 0:s.dasar_adendum)==="Timeline"&&((b=a.original)==null?void 0:b.DetailAdendums.map((r,k)=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[r.nama_column==="timeline_awal"?"T.awal":"T.akhir"," ","sebelum :"," ",L(r.value_sebelum)]}),e.jsxs("div",{children:[r.nama_column==="timeline_awal"?"T.awal":"T.akhir"," ","sesudah :"," ",L(r.value_adendum)]})]},k))),((M=a.original)==null?void 0:M.dasar_adendum)==="Nilai Kontrak"&&((H=a.original)==null?void 0:H.DetailAdendums.map((r,k)=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:["Nilai kontrak sebelum :"," ",U(r.value_sebelum)]}),e.jsxs("div",{children:["Nilai kontrak sesudah :"," ",U(r.value_adendum)]})]},k))),((F=a.original)==null?void 0:F.dasar_adendum)==="Lokasi"&&((O=a.original)==null?void 0:O.DetailAdendums.map((r,k)=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[r.nama_column==="lokasi"?"Lokasi":r.nama_column==="longitude"?"Longitude":"Latitude"," ","sebelum :"," ",r.value_sebelum]}),e.jsxs("div",{children:[r.nama_column==="lokasi"?"Lokasi":r.nama_column==="longitude"?"Longitude":"Latitude"," ","sesudah :"," ",r.value_adendum]})]},k)))]})})]},a.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(me,{pageSize:w,currentPage:X,total:Y,onChange:se}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ge,{size:"sm",menuPlacement:"top",isSearchable:!1,value:z.filter(a=>a.value===w),options:z,onChange:a=>ne(a==null?void 0:a.value)})})]})]})}const Ie=p.forwardRef(Le),Pe=()=>{const i=R(),o=f(t=>t.adendumList.data.updateConfirmation),u=f(t=>t.adendumList.data.selectedAdendum),c=f(t=>t.adendumList.data.adendumStatus),l=f(t=>t.adendumList.data.tableData),d=()=>{i(y(!1))},m=async()=>{i(y(!1));try{let t;c==="Terima"?t=await W({id:u,status:"Sudah Disetujui"}):c==="Tolak"&&(t=await W({id:u,status:"Tidak Disetujui"})),t&&(i(I(l)),q.push(e.jsx(V,{title:"Successfuly Updated",type:"success",duration:2500,children:"Status berhasil di perbarui"}),{placement:"top-center"}))}catch(t){console.error("Error deleting notification:",t),q.push(e.jsx(V,{title:"Gagal Update Status Proyek",type:"danger",duration:2500,children:t.response.data.message}),{placement:"top-center"})}};return e.jsx(ye,{isOpen:o,type:"warning",title:"Ubah Status",onConfirm:m,onClose:d,onRequestClose:d,onCancel:d,children:e.jsx("p",{children:"Apakah kamu yakin ingin mengupdate status proyek ?"})})},ze=({row:i})=>{const o=R(),u=l=>{l.stopPropagation(),o(y(!0)),o(K(i.id)),o(B("Terima"))},c=l=>{l.stopPropagation(),o(y(!0)),o(K(i.id)),o(B("Tolak"))};return e.jsxs("div",{className:"flex justify-end gap-2",children:[i.status==="Belum Disetujui"&&e.jsxs(e.Fragment,{children:[e.jsx($,{size:"sm",variant:"solid",onClick:l=>u(l),children:"Terima"}),e.jsx($,{size:"sm",onClick:l=>c(l),children:"Tolak"})]}),i.status==="Sudah Disetujui"&&e.jsx("div",{className:"text-green-600 px-4 rounded-lg py-2 bg-green-100",children:i.status}),i.status==="Tidak Disetujui"&&e.jsx("div",{className:"text-red-600 px-4 rounded-lg py-2 bg-red-50",children:i.status})]})},Ee=()=>{const i=p.useRef(null),o=R(),{pageIndex:u,pageSize:c,query:l,total:d}=f(n=>n.adendumList.data.tableData),m=f(n=>n.adendumList.data.filterData),t=f(n=>n.adendumList.data.loading),g=f(n=>n.adendumList.data.adendumsList);p.useEffect(()=>{S()},[u,c]),p.useEffect(()=>{var n;i&&((n=i.current)==null||n.resetSorting())},[m]);const x=p.useMemo(()=>({pageIndex:u,pageSize:c,query:l,total:d}),[u,c,l,d]),S=()=>{o(I({page:u,limit:c,query:l,filterData:m}))},C=p.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:n})=>e.jsx(e.Fragment,{children:n.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:n.getToggleExpandedHandler(),children:n.getIsExpanded()?e.jsx(he,{}):e.jsx(xe,{})}):null}),subCell:()=>null},{header:"Dasar Adendum",accessorKey:"dasar_adendum",cell:n=>{const h=n.row.original;return e.jsx("span",{className:"capitalize",children:h.dasar_adendum})}},{header:"Tanggal",accessorKey:"tanggal",cell:n=>{const h=n.row.original;return e.jsx("span",{className:"capitalize",children:L(h.tanggal)})}},{header:"Pekerjaan",accessorKey:"pekerjaan",minWidth:350,cell:n=>{const h=n.row.original;return e.jsx("span",{className:"capitalize",children:h.Project.pekerjaan})}},{header:"",id:"action",cell:n=>e.jsx(ze,{row:n.row.original})}],[]),D=n=>{const h=_(x);h.pageIndex=n,o(N(h))},v=n=>{const h=_(x);h.pageSize=Number(n),h.pageIndex=1,o(N(h))};return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{ref:i,getRowCanExpand:()=>!0,columns:C,data:g,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:t,pagingData:{total:x.total,pageIndex:x.pageIndex,pageSize:x.pageSize},onPaginationChange:D,onSelectChange:v}),e.jsx(Pe,{})]})},Me=()=>{const i=R(),o=p.useRef(null),u=f(t=>t.adendumList.data.tableData),c=Re(l,500);function l(t){const g=_(u);g.query=t,g.pageIndex=1,typeof t=="string"&&t.length>1&&d(g),typeof t=="string"&&t.length===0&&d(g)}const d=t=>{i(N(t)),i(I(t))},m=t=>{c(t.target.value)};return e.jsx(fe,{ref:o,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari adendum",prefix:e.jsx(je,{className:"text-lg"}),onChange:m})},He=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center",children:e.jsx(Me,{})});re("adendumList",ce);const Fe=()=>e.jsxs(ue,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Adendum"}),e.jsx(He,{})]}),e.jsx(Ee,{})]}),Ge=Fe;export{Ge as default};
