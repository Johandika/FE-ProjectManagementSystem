import{ah as X,ai as U,aj as ee,ak as ae,al as te,r as i,j as e,am as se,c as ne,u as H,W as le,i as oe}from"./index-8f324225.js";import{a as re}from"./UserService-c266ba79.js";import{A as ie}from"./AdaptableCard-54b628e2.js";import{aZ as O,a_ as ce,w as $,aD as de,a$ as ge,b0 as ue,B as w,J as I,P as me,F as pe,v as fe,k as he}from"./Views-a6cda74e.js";import{u as xe,f as z,T as je,g as Se,a as be,b as Ce,c as De,d as we}from"./index-fee04496.js";import"./SvgIcon-d3af2c92.js";import"./ConfirmDialog-cacab1ef.js";import"./DataTable-66df47f9.js";import{F as Re,a as ve,b as ye}from"./formik.esm-79e86e67.js";import"./useThemeClass-fe409b1f.js";async function ke(t){const a=new URLSearchParams;t.tanggal&&a.append("tanggal",t.tanggal.toString()),t.status&&a.append("status",t.status.toString()),t.filterData.idUser&&a.append("idUser",t.filterData.idUser.toString()),t.page&&a.append("page",t.page.toString()),t.limit&&a.append("limit",t.limit.toString());const o=`/log${a.toString()?`?${a.toString()}`:""}`;return X.fetchData({url:o,method:"get"})}const T="logList",k=U(T+"/getLogs",async t=>{const a=await ke(t);return{data:a.data.data,total:a.data.totaldataLog,totalPage:a.data.totalPage}}),L=U(T+"/getPenggunas",async t=>(await re(t)).data),Le={total:0,pageIndex:1,pageSize:10,query:"",idUser:""},Te={loading:!1,loadingPenggunas:!1,logsList:[],penggunaList:[],tableData:Le,filterData:{name:"",category:[],status:[],idUser:"",productStatus:0}},W=ee({name:`${T}/state`,initialState:Te,reducers:{setTableData:(t,a)=>{t.tableData=a.payload},setFilterData:(t,a)=>{t.filterData=a.payload}},extraReducers:t=>{t.addCase(k.fulfilled,(a,o)=>{a.logsList=o.payload.data,a.tableData.total=o.payload.total,a.tableData.totalPage=o.payload.totalPage,a.loading=!1}).addCase(k.pending,a=>{a.loading=!0}).addCase(L.fulfilled,(a,o)=>{a.penggunaList=o.payload,a.loadingPenggunas=!1}).addCase(L.pending,a=>{a.loadingPenggunas=!0})}}),{setTableData:M,setFilterData:Fe}=W.actions,Ne=W.reducer,Pe=ae({data:Ne}),C=te,{Tr:y,Th:Ie,Td:E,THead:ze,TBody:Me,Sorter:Ee}=O,A=t=>{const{indeterminate:a,onChange:o,onCheckBoxChange:d,onIndeterminateCheckBoxChange:r,...g}=t,u=i.useRef(null);i.useEffect(()=>{typeof a=="boolean"&&u.current&&(u.current.indeterminate=!g.checked&&a)},[u,a]);const c=f=>{o(f),d==null||d(f),r==null||r(f)};return e.jsx(de,{ref:u,className:"mb-0",onChange:(f,p)=>c(p),...g})};function Ae(t,a){const{skeletonAvatarColumns:o,columns:d=[],data:r=[],loading:g=!1,onCheckBoxChange:u,onIndeterminateCheckBoxChange:c,onPaginationChange:f,onSelectChange:p,onSort:h,onRowClick:x,pageSizes:j=[10,25,50,100],selectable:b=!1,skeletonAvatarProps:s,getRowCanExpand:m,pagingData:F={total:0,pageIndex:1,pageSize:10}}=t,{pageSize:R,pageIndex:V,total:Y}=F,[S,_]=i.useState(null),N=i.useMemo(()=>j.map(n=>({value:n,label:`${n} / page`})),[j]),q=(n,l)=>{g||u==null||u(n,l)},B=(n,l)=>{g||c==null||c(n,l)},G=n=>{g||f==null||f(n)},J=n=>{g||p==null||p(Number(n))};i.useEffect(()=>{if(Array.isArray(S)){const n=S.length>0?S[0].desc?"desc":"asc":"",l=S.length>0?S[0].id:"";h==null||h({order:n,key:l})}},[S]);const P=i.useMemo(()=>{const n=d;return b?[{id:"select",header:({table:l})=>e.jsx(A,{checked:l.getIsAllRowsSelected(),indeterminate:l.getIsSomeRowsSelected(),onChange:l.getToggleAllRowsSelectedHandler(),onIndeterminateCheckBoxChange:v=>{B(v.target.checked,l.getRowModel().rows)}}),cell:({row:l})=>e.jsx(A,{checked:l.getIsSelected(),disabled:!l.getCanSelect(),indeterminate:l.getIsSomeSelected(),onChange:l.getToggleSelectedHandler(),onCheckBoxChange:v=>q(v.target.checked,l.original)})},...n]:n},[d,b]),D=xe({data:r,getRowCanExpand:m,getExpandedRowModel:Se(),columns:P,getCoreRowModel:be(),getFilteredRowModel:Ce(),getPaginationRowModel:De(),getSortedRowModel:we(),manualPagination:!0,manualSorting:!0,onSortingChange:n=>{_(n)},state:{sorting:S}}),Z=()=>{D.resetSorting()},Q=()=>{D.toggleAllRowsSelected(!1)};return i.useImperativeHandle(a,()=>({resetSorting:Z,resetSelected:Q})),e.jsxs(se,{loading:g&&r.length!==0,type:"cover",children:[e.jsxs(O,{children:[e.jsx(ze,{children:D.getHeaderGroups().map(n=>e.jsx(y,{children:n.headers.map(l=>e.jsx(Ie,{colSpan:l.colSpan,style:{width:l.column.columnDef.width,minWidth:l.column.columnDef.minWidth},children:l.isPlaceholder?null:e.jsxs("div",{className:ne(l.column.getCanSort()&&"cursor-pointer select-none point",g&&"pointer-events-none"),onClick:l.column.getToggleSortingHandler(),children:[z(l.column.columnDef.header,l.getContext()),l.column.getCanSort()&&e.jsx(Ee,{sort:l.column.getIsSorted()})]})},l.id))},n.id))}),g&&r.length===0?e.jsx(je,{columns:P.length,rows:F.pageSize,avatarInColumns:o,avatarProps:s}):e.jsx(Me,{children:D.getRowModel().rows.slice(0,R).map(n=>e.jsxs(i.Fragment,{children:[e.jsx(y,{className:x?"cursor-pointer hover:bg-gray-50":"",onClick:()=>x&&x(n.original),children:n.getVisibleCells().map(l=>e.jsx(E,{style:{width:l.column.columnDef.width,minWidth:l.column.columnDef.minWidth},children:z(l.column.columnDef.cell,l.getContext())},l.id))},n.id),n.getIsExpanded()&&e.jsx(y,{children:e.jsx(E,{colSpan:n.getVisibleCells().length,className:"w-full",children:e.jsx("div",{children:e.jsx("div",{children:n.original.pesan})})})})]},n.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(ce,{pageSize:R,currentPage:V,total:Y,onChange:G}),e.jsx("div",{style:{minWidth:130},children:e.jsx($,{size:"sm",menuPlacement:"top",isSearchable:!1,value:N.filter(n=>n.value===R),options:N,onChange:n=>J(n==null?void 0:n.value)})})]})]})}const Ue=i.forwardRef(Ae),He=()=>{const t=i.useRef(null),a=H(),{pageIndex:o,pageSize:d,query:r,total:g}=C(s=>s.logList.data.tableData),u=C(s=>s.logList.data.filterData),c=C(s=>s.logList.data.loading),f=C(s=>s.logList.data.logsList);i.useEffect(()=>{h()},[o,d,u]),i.useEffect(()=>{var s;t&&((s=t.current)==null||s.resetSorting())},[u,o,d]);const p=i.useMemo(()=>({pageIndex:o,pageSize:d,query:r,total:g}),[o,d,r,g]),h=()=>{a(k({page:o,limit:d,query:r,filterData:u}))},x=i.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:s})=>e.jsx(e.Fragment,{children:s.getCanExpand()?e.jsx("button",{className:"text-lg",onClick:s.getToggleExpandedHandler(),children:s.getIsExpanded()?e.jsx(ge,{}):e.jsx(ue,{})}):null}),subCell:()=>null},{header:"Tipe Log",accessorKey:"type",cell:s=>{const m=s.row.original;return e.jsx("span",{className:"capitalize",children:m.type})}},{header:"Status",accessorKey:"status",cell:s=>{const m=s.row.original;return e.jsx("span",{className:"capitalize",children:e.jsx(w,{variant:"solid",shape:"circle",size:"xs",color:m.status==="Success"?"green":"red",className:"cursor-auto",children:m.status})})}},{header:"Tanggal",accessorKey:"tanggal",cell:s=>{const m=s.row.original;return e.jsx("span",{className:"capitalize",children:le(m.tanggal).format("HH:mm, DD-MM-YYYY")})}},{header:"User",accessorKey:"user",cell:s=>{const m=s.row.original;return e.jsx("span",{className:"capitalize",children:m.User.nama||"-"})}}],[]),j=s=>{const m=I(p);m.pageIndex=s,a(M(m))},b=s=>{const m=I(p);m.pageSize=Number(s),m.pageIndex=1,a(M(m))};return e.jsx(e.Fragment,{children:e.jsx(Ue,{ref:t,getRowCanExpand:()=>!0,columns:x,data:f,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:c,pagingData:{total:p.total,pageIndex:p.pageIndex,pageSize:p.pageSize},onPaginationChange:j,onSelectChange:b})})},K=i.forwardRef(({onSubmitComplete:t},a)=>{const o=H(),d=C(c=>c.logList.data.filterData),r=C(c=>c.logList.data.penggunaList.data),g=i.useRef(null),u=c=>{t==null||t(),o(Fe(c))};return i.useEffect(()=>{var c;(c=g.current)==null||c.setValues(d)},[d]),i.useEffect(()=>{o(L())},[]),e.jsx(Re,{enableReinitialize:!0,innerRef:a,initialValues:d,onSubmit:c=>{u(c)},children:({values:c,touched:f,errors:p})=>e.jsx(ve,{children:e.jsx(me,{children:e.jsx(pe,{label:"Klien",invalid:p.idUser&&f.idUser,errorMessage:p.idUser,children:e.jsx(ye,{name:"idUser",children:({field:h,form:x})=>{const j=h.value?r.find(s=>s.id===h.value):null,b=(r==null?void 0:r.map(s=>({value:s.id,label:`${s.nama}`})))||null;return e.jsx($,{field:h,form:x,options:b,value:j?{value:j.nama,label:`${j.nama}`}:null,placeholder:"Pilih user",onChange:s=>{x.setFieldValue(h.name,s==null?void 0:s.value)}})}})})})})})}),Oe=({onSaveClick:t,onCancel:a})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(w,{size:"sm",className:"mr-2",onClick:a,children:"Cancel"}),e.jsx(w,{size:"sm",variant:"solid",onClick:t,children:"Terapkan"})]}),$e=()=>{const t=i.useRef(null),[a,o]=i.useState(!1),d=()=>{o(!0)},r=()=>{o(!1)},g=()=>{var u;(u=t.current)==null||u.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(fe,{}),onClick:()=>d(),children:"Filter"}),e.jsx(he,{title:"Filter",isOpen:a,footer:e.jsx(Oe,{onCancel:r,onSaveClick:g}),onClose:r,onRequestClose:r,children:e.jsx(K,{ref:t,onSubmitComplete:r})})]})};K.displayName="FilterForm";const We=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center",children:e.jsx($e,{})});oe("logList",Pe);const Ke=()=>e.jsxs(ie,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Log"}),e.jsx(We,{})]}),e.jsx(He,{})]}),ea=Ke;export{ea as default};
