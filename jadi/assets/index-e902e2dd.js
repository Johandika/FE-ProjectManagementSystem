import{ai as R,aj as z,ak as A,al as O,u as D,j as e,r as p,a7 as E,as as H,a as q,L as M,i as $}from"./index-8f324225.js";import{a as B,b as V}from"./KlienService-a48e76b8.js";import{A as G}from"./AdaptableCard-54b628e2.js";import{D as J}from"./DataTable-66df47f9.js";import{t as Q,N as _,I as U,H as W,J as C,K as X,L as Y,P as Z,F as ee,w as ae,B as v,v as te,k as se,Q as ne}from"./Views-a6cda74e.js";import{u as ie}from"./useThemeClass-fe409b1f.js";import{C as le}from"./ConfirmDialog-cacab1ef.js";import{d as oe}from"./debounce-9aa8ee7b.js";import{F as re,a as ce,b as de}from"./formik.esm-79e86e67.js";import"./index-fee04496.js";const L="klienList",x=R(L+"/getKliens",async a=>{const t=await B(a);return{data:t.data.data,total:t.data.totaldataClient,totalPage:t.data.totalPage}}),ue=async a=>(await V(a)).data,N={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},me={loading:!1,deleteConfirmation:!1,selectedProduct:"",productList:[],tableData:N,filterData:{name:"",category:["bags","cloths","devices","shoes","d"],status:[0,1,2],productStatus:0}},K=z({name:`${L}/state`,initialState:me,reducers:{updateProductList:(a,t)=>{a.productList=t.payload},setTableData:(a,t)=>{a.tableData=t.payload},setFilterData:(a,t)=>{a.filterData=t.payload},toggleDeleteConfirmation:(a,t)=>{a.deleteConfirmation=t.payload},setSelectedProduct:(a,t)=>{a.selectedProduct=t.payload}},extraReducers:a=>{a.addCase(x.fulfilled,(t,s)=>{t.productList=s.payload.data,t.tableData.total=s.payload.total,t.tableData.totalPage=s.payload.totalPage,t.loading=!1}).addCase(x.pending,t=>{t.loading=!0})}}),{updateProductList:ze,setTableData:y,setFilterData:pe,toggleDeleteConfirmation:S,setSelectedProduct:he}=K.actions,fe=K.reducer,ge=A({data:fe}),h=O,xe=()=>{const a=D(),t=h(r=>r.klienList.data.deleteConfirmation),s=h(r=>r.klienList.data.selectedProduct),o=h(r=>r.klienList.data.tableData),l=()=>{a(S(!1))},u=async()=>{a(S(!1)),await ue({id:s})&&(a(x(o)),Q.push(e.jsx(_,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(le,{isOpen:t,type:"danger",title:"Hapus Klien",confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:u,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus klien ini?"})})},De=({row:a})=>{const t=D(),{textTheme:s}=ie(),o=E(),l=()=>{o(`/master/klien-edit/${a.id}`)},u=()=>{t(S(!0)),t(he(a.id))};return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${s}`,onClick:l,children:e.jsx(U,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:u,children:e.jsx(W,{})})]})},be=()=>{const a=p.useRef(null),t=D(),s=h(n=>n.auth.user),{pageIndex:o,pageSize:l,sort:u,query:r,total:c}=h(n=>n.klienList.data.tableData),i=h(n=>n.klienList.data.filterData),w=h(n=>n.klienList.data.loading),b=h(n=>n.klienList.data.productList);p.useEffect(()=>{j()},[o,l,u,i]),p.useEffect(()=>{var n;a&&((n=a.current)==null||n.resetSorting())},[i]);const m=p.useMemo(()=>({pageIndex:o,pageSize:l,sort:u,query:r,total:c}),[o,l,u,r,c]),j=()=>{t(x({pageIndex:o,pageSize:l,query:r,filterData:i}))},k=p.useMemo(()=>{const n=[{header:"Nama",accessorKey:"nama",cell:d=>{const g=d.row.original;return e.jsx("span",{className:"capitalize",children:g.nama})}},{header:"Divisi",accessorKey:"Divisi",cell:d=>{var F;const g=d.row.original;return e.jsx("span",{children:((F=g==null?void 0:g.Divisi)==null?void 0:F.name)||""})}},{header:"Keterangan",accessorKey:"keterangan",cell:d=>{const g=d.row.original;return e.jsx("span",{className:"capitalize",children:g.keterangan})}}];return(s==null?void 0:s.authority)!=="Admin"&&(s==null?void 0:s.authority)!=="Owner"&&n.push({header:"",id:"action",cell:d=>e.jsx(De,{row:d.row.original})}),n},[s]),f=n=>{const d=C(m);d.pageIndex=n,t(y(d))},T=n=>{const d=C(m);d.pageSize=Number(n),d.pageIndex=1,t(y(d))},I=n=>{const d=C(m);d.sort=n,t(y(d))};return e.jsxs(e.Fragment,{children:[e.jsx(J,{ref:a,columns:k,data:b,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:w,pagingData:{total:m.total,pageIndex:m.pageIndex,pageSize:m.pageSize,totalPage:m.totalPage},onPaginationChange:f,onSelectChange:T,onSort:I}),e.jsx(xe,{})]})},je=()=>{const a=D(),t=p.useRef(null),s=h(c=>c.klienList.data.tableData),o=oe(l,500);function l(c){const i=C(s);i.query=c,i.pageIndex=1,typeof c=="string"&&c.length>1&&u(i),typeof c=="string"&&c.length===0&&u(i)}const u=c=>{a(y(c)),a(x(c))},r=c=>{o(c.target.value)};return e.jsx(X,{ref:t,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari klien",prefix:e.jsx(Y,{className:"text-lg"}),onChange:r})},P=p.forwardRef(({onSubmitComplete:a},t)=>{const s=D(),{selectDivisi:o,loadingSelectDivisi:l}=h(i=>i.base.common),u=h(i=>i.klienList.data.filterData),r=p.useMemo(()=>o!=null&&o.data?o.data.map(i=>({value:i.id,label:i.name})):[],[o]),c=i=>{a==null||a(),s(pe(i)),s(x(N))};return p.useEffect(()=>{s(H())},[]),e.jsx(re,{enableReinitialize:!0,innerRef:t,initialValues:u,onSubmit:i=>{c(i)},children:({values:i,touched:w,errors:b})=>e.jsx(ce,{children:e.jsx(Z,{children:e.jsx(ee,{label:"Klien",invalid:b.idDivisi&&w.idDivisi,errorMessage:b.idDivisi,children:e.jsx(de,{name:"idDivisi",children:({field:m,form:j})=>{const k=m.value?r.find(f=>f.value===m.value):null;return e.jsx(ae,{field:m,form:j,options:r,isLoading:l,value:k||null,placeholder:"Pilih divisi",onChange:f=>{j.setFieldValue(m.name,f==null?void 0:f.value)}})}})})})})})}),ke=({onSaveClick:a,onCancel:t})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(v,{size:"sm",className:"mr-2",onClick:t,children:"Cancel"}),e.jsx(v,{size:"sm",variant:"solid",onClick:a,children:"Terapkan"})]}),Ce=()=>{const a=p.useRef(null),[t,s]=p.useState(!1),o=()=>{s(!0)},l=()=>{s(!1)},u=()=>{var r;(r=a.current)==null||r.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(te,{}),onClick:()=>o(),children:"Filter"}),e.jsx(se,{title:"Filter",isOpen:t,footer:e.jsx(ke,{onCancel:l,onSaveClick:u}),onClose:l,onRequestClose:l,children:e.jsx(P,{ref:a,onSubmitComplete:l})})]})};P.displayName="FilterForm";const ye=()=>{const a=q(t=>t.auth.user);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(je,{}),e.jsx(Ce,{}),a.authority!=="Admin"&&a.authority!=="Owner"&&e.jsx(M,{className:"block lg:inline-block md:mb-0 mb-4 md:ml-2 ",to:"/master/klien-new",children:e.jsx(v,{block:!0,variant:"solid",size:"sm",icon:e.jsx(ne,{}),children:"Tambah Klien"})})]})};$("klienList",ge);const ve=()=>e.jsxs(G,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Klien"}),e.jsx(ye,{})]}),e.jsx(be,{})]}),Ae=ve;export{Ae as default};
