import{ai as Q,aj as Y,ak as W,al as X,G as M,u as b,j as e,r as h,a7 as T,aw as Z,as as ee,L as ae,i as se,a as te}from"./index-8f324225.js";import{a as ne,b as ie,c as oe}from"./UserService-c266ba79.js";import{A as re}from"./AdaptableCard-54b628e2.js";import{D as le}from"./DataTable-66df47f9.js";import{t as y,N as C,a5 as ce,F as N,K as R,B as P,by as de,aY as ue,I as pe,H as ge,J as L,L as me,P as he,w as fe,v as xe,k as we,Q as je}from"./Views-a6cda74e.js";import{u as ve}from"./useThemeClass-fe409b1f.js";import{C as _}from"./ConfirmDialog-cacab1ef.js";import{F as E,a as B,b as A}from"./formik.esm-79e86e67.js";import{c as $,a as q}from"./index.esm-02ea902b.js";import"./SvgIcon-d3af2c92.js";import{d as be}from"./debounce-9aa8ee7b.js";import"./index-fee04496.js";const K="penggunaList",v=Q(K+"/apiGetUsers",async a=>{const s=await ne(a);return{data:s.data.data,total:s.data.totaldataUser,totalPage:s.data.totalPage}}),V={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},De={loading:!1,deleteConfirmation:!1,selectedPengguna:"",penggunaList:[],dialogUpdatePassword:!1,dialogResetPassword:!1,idUserActive:"",tableData:V,filterData:{idDivisi:""}},G=Y({name:`${K}/state`,initialState:De,reducers:{updatePenggunaList:(a,s)=>{a.penggunaList=s.payload},setTableData:(a,s)=>{a.tableData=s.payload},setFilterData:(a,s)=>{a.filterData=s.payload},toggleDeleteConfirmation:(a,s)=>{a.deleteConfirmation=s.payload},setSelectedPengguna:(a,s)=>{a.selectedPengguna=s.payload},setDialogUpdatePassword:(a,s)=>{a.dialogUpdatePassword=s.payload},setDialogResetPassword:(a,s)=>{a.dialogResetPassword=s.payload},setIdUserActive:(a,s)=>{a.idUserActive=s.payload}},extraReducers:a=>{a.addCase(v.fulfilled,(s,o)=>{s.penggunaList=o.payload.data,s.tableData.total=o.payload.total,s.loading=!1}).addCase(v.pending,s=>{s.loading=!0})}}),{updatePenggunaList:Xe,setTableData:F,setFilterData:ye,toggleDeleteConfirmation:I,setDialogUpdatePassword:U,setDialogResetPassword:z,setIdUserActive:O,setSelectedPengguna:Ce}=G.actions,Pe=G.reducer,Se=W({data:Pe}),m=X;function ke(a){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13 3a9 9 0 0 0-9 9H1l4 4 4-4H6c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-1.9 0-3.62-.76-4.88-1.99L6.7 18.42A8.982 8.982 0 0 0 13 21a9 9 0 0 0 0-18zm2 8v-1c0-1.1-.9-2-2-2s-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1zm-1 0h-2v-1c0-.55.45-1 1-1s1 .45 1 1v1z"},child:[]}]})(a)}function Le(a){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M2 17h20v2H2v-2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48 1.3.75zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7l-.85 1.48zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23v-1.5z"},child:[]}]})(a)}const Fe=()=>{const a=b(),s=m(c=>c.penggunaList.data.deleteConfirmation),o=m(c=>c.penggunaList.data.selectedPengguna),l=m(c=>c.penggunaList.data.tableData),r=()=>{a(I(!1))},p=async()=>{a(I(!1)),await ie({id:o})&&(a(v(l)),y.push(e.jsx(C,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(_,{isOpen:s,type:"danger",title:"Hapus Pengguna",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:p,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus pengguna ini?"})})},Ne=$().shape({old_password:q().required("Tanggal wajib diisi")});function Re(){const a=b(),[s,o]=h.useState("password"),l=T(),[r,p]=h.useState({old_password:"",new_password:"",id:""}),c=m(d=>d.penggunaList.data.dialogUpdatePassword),t=m(d=>d.penggunaList.data.idUserActive),i=d=>{d.preventDefault(),o(s==="password"?"text":"password")},g=e.jsx("span",{className:"cursor-pointer",onClick:d=>i(d),children:s==="password"?e.jsx(de,{}):e.jsx(ue,{})}),j=d=>{y.push(e.jsxs(C,{title:`Successfuly ${d}`,type:"success",duration:2500,children:["Password successfuly ",d]}),{placement:"top-center"}),l("/peran-dan-pengguna/pengguna")},w=()=>{a(U(!1))},x=async(d,{setSubmitting:f})=>{f(!0);const D={...d,id:t||""};let S=!1;try{S=await oe(D),S&&(a(U(!1)),a(v()),j("diperbarui"))}catch(k){y.push(e.jsx(C,{title:"Update Password Failed",type:"danger",duration:2500,children:k.response.data.message}),{placement:"top-center"})}finally{f(!1)}};return e.jsx(E,{initialValues:r,validationSchema:Ne,onSubmit:x,enableReinitialize:!0,children:({errors:d,touched:f,isSubmitting:D,values:S,setFieldValue:k})=>e.jsx(e.Fragment,{children:e.jsx(ce,{isOpen:c,onClose:w,onRequestClose:w,children:e.jsxs(B,{children:[e.jsx("h5",{className:"mb-4",children:"Ubah Password"}),e.jsx(N,{label:"Password Lama",invalid:d.old_password&&f.old_password,errorMessage:d.old_password,children:e.jsx(A,{autoComplete:"off",name:"old_password",suffix:g,type:s,placeholder:"password",component:R})}),e.jsx(N,{label:"Password Baru",invalid:d.new_password&&f.new_password,errorMessage:d.new_password,children:e.jsx(A,{autoComplete:"off",name:"new_password",suffix:g,type:s,placeholder:"password",component:R})}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(P,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:w,type:"button",disabled:D,children:"Cancel"}),e.jsx(P,{variant:"solid",type:"submit",loading:D,children:"Simpan"})]})]})})})})}$().shape({old_password:q().required("Tanggal wajib diisi")});function Ae(){const a=b(),s=T(),o=()=>{a(z(!1))},l=m(t=>t.penggunaList.data.dialogResetPassword),r=m(t=>t.penggunaList.data.idUserActive),p=t=>{y.push(e.jsxs(C,{title:`Successfuly ${t}`,type:"success",duration:2500,children:["Berhasil melakukan ",t]}),{placement:"top-center"}),s("/peran-dan-pengguna/pengguna")},c=async()=>{try{const i=await Z({id:r});i.data.statusCode===200?(a(z(!1)),p("reset password"),a(v())):y.push(e.jsx(C,{title:"Update Status Failed",type:"danger",duration:2500,children:i.data.statusCode.message}),{placement:"top-center"})}catch(t){console.error("Error updating status faktur:",t),y.push(e.jsx(C,{title:"Update Status Failed",type:"danger",duration:2500,children:"Gagal memperbarui status faktur"}),{placement:"top-center"})}};return e.jsx(_,{isOpen:l,onClose:o,onRequestClose:o,onCancel:o,type:"warning",title:"Reset Password",onConfirm:c,children:e.jsx("p",{children:"Apakah kamu yakin ingin mereset password ?"})})}const Ie=({row:a})=>{const s=b(),{textTheme:o}=ve(),l=T(),r=()=>{l(`/peran-dan-pengguna/pengguna-edit/${a.id}`)},p=g=>{s(U(!0)),s(O(g.id))},c=g=>{s(z(!0)),s(O(g.id))},t=()=>{s(I(!0)),s(Ce(a.id))},i=m(g=>g.auth.user);return e.jsxs("div",{className:"flex justify-end text-lg",children:[a.email===i.email&&e.jsx("span",{className:`cursor-pointer p-2 hover:${o}`,onClick:g=>{g.stopPropagation(),p(a)},children:e.jsx(Le,{})}),i.authority==="Super Admin"&&e.jsx("span",{className:`cursor-pointer p-2 hover:${o}`,onClick:g=>{g.stopPropagation(),c(a)},children:e.jsx(ke,{})}),e.jsx("span",{className:`cursor-pointer p-2 hover:${o}`,onClick:r,children:e.jsx(pe,{})}),i.authority==="Super Admin"&&e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:t,children:e.jsx(ge,{})})]})},Ue=()=>{const a=h.useRef(null),s=b(),{pageIndex:o,pageSize:l,sort:r,query:p,total:c}=m(n=>n.penggunaList.data.tableData),t=m(n=>n.penggunaList.data.filterData),i=m(n=>n.auth.user),{loading:g}=m(n=>n.penggunaList.data),{penggunaList:j}=m(n=>n.penggunaList.data),w=h.useMemo(()=>i.authority==="Super Admin"?j:j.filter(n=>n.email===i.email),[i,j]);h.useEffect(()=>{d()},[o,l,r,t]),h.useEffect(()=>{var n;a&&((n=a.current)==null||n.resetSorting())},[t]);const x=h.useMemo(()=>({pageIndex:o,pageSize:l,sort:r,query:p,total:c}),[o,l,r,p,c]),d=()=>{s(v({pageIndex:o,pageSize:l,sort:r,query:p,filterData:t}))},f=h.useMemo(()=>[{header:"Nama",accessorKey:"pengguna",cell:n=>{const u=n.row.original;return e.jsx("span",{className:"capitalize",children:u.nama})}},{header:"Email",accessorKey:"email",cell:n=>{const u=n.row.original;return e.jsx("span",{children:u.email})}},{header:"Peran",accessorKey:"peran",cell:n=>{const u=n.row.original;return e.jsx("span",{children:u.Role.nama})}},{header:"Divisi",accessorKey:"divisi",cell:n=>{var H;const u=n.row.original;return e.jsx("span",{children:(H=u.Divisi)==null?void 0:H.name})}},{header:"Kontak",accessorKey:"kontak",cell:n=>{const u=n.row.original;return e.jsx("span",{className:"capitalize",children:u.nomor_telepon})}},{header:"",id:"action",cell:n=>e.jsx(Ie,{row:n.row.original})}],[]),D=n=>{const u=L(x);u.pageIndex=n,s(F(u))},S=n=>{const u=L(x);u.pageSize=Number(n),u.pageIndex=1,s(F(u))},k=n=>{const u=L(x);u.sort=n,s(F(u))};return e.jsxs(e.Fragment,{children:[e.jsx(le,{ref:a,columns:f,data:w,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:g,pagingData:{total:x.total,pageIndex:x.pageIndex,pageSize:x.pageSize},onPaginationChange:D,onSelectChange:S,onSort:k}),e.jsx(Fe,{}),e.jsx(Re,{}),e.jsx(Ae,{})]})},ze=()=>{const a=b(),s=h.useRef(null),o=m(t=>t.penggunaList.data.tableData),l=be(r,500);function r(t){const i=L(o);i.query=t,i.pageIndex=1,typeof t=="string"&&t.length>1&&p(i),typeof t=="string"&&t.length===0&&p(i)}const p=t=>{a(F(t)),a(v(t))},c=t=>{l(t.target.value)};return e.jsx(R,{ref:s,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari pengguna",prefix:e.jsx(me,{className:"text-lg"}),onChange:c})},J=h.forwardRef(({onSubmitComplete:a},s)=>{const o=b(),{selectDivisi:l,loadingSelectDivisi:r}=m(i=>i.base.common),p=m(i=>i.penggunaList.data.filterData),c=i=>{a==null||a(),o(ye(i)),o(v(V))},t=h.useMemo(()=>l!=null&&l.data?l.data.map(i=>({value:i.id,label:i.name})):[],[l]);return h.useEffect(()=>{o(ee())},[]),e.jsx(E,{enableReinitialize:!0,innerRef:s,initialValues:p,onSubmit:i=>{c(i)},children:({values:i,touched:g,errors:j})=>e.jsx(B,{children:e.jsx(he,{children:e.jsx(N,{label:"Klien",invalid:j.idDivisi&&g.idDivisi,errorMessage:j.idDivisi,children:e.jsx(A,{name:"idDivisi",children:({field:w,form:x})=>{const d=w.value?t.find(f=>f.value===w.value):null;return e.jsx(fe,{field:w,form:x,options:t,isLoading:r,value:d||null,placeholder:"Pilih divisi",onChange:f=>{x.setFieldValue(w.name,f==null?void 0:f.value)}})}})})})})})}),Te=({onSaveClick:a,onCancel:s})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(P,{size:"sm",className:"mr-2",onClick:s,children:"Cancel"}),e.jsx(P,{size:"sm",variant:"solid",onClick:a,children:"Terapkan"})]}),He=()=>{const a=h.useRef(null),[s,o]=h.useState(!1),l=()=>{o(!0)},r=()=>{o(!1)},p=()=>{var c;(c=a.current)==null||c.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(xe,{}),onClick:()=>l(),children:"Filter"}),e.jsx(we,{title:"Filter",isOpen:s,footer:e.jsx(Te,{onCancel:r,onSaveClick:p}),onClose:r,onRequestClose:r,children:e.jsx(J,{ref:a,onSubmitComplete:r})})]})};J.displayName="FilterForm";const Oe=()=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(ze,{}),e.jsx(He,{}),e.jsx(ae,{className:"block lg:inline-block md:mb-0 mb-4 ml-2",to:"/peran-dan-pengguna/pengguna-new",children:e.jsx(P,{block:!0,variant:"solid",size:"sm",icon:e.jsx(je,{}),children:"Tambah Pengguna"})})]});se("penggunaList",Se);const Me=()=>{const a=te(s=>s.auth.user);return e.jsxs(re,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Pengguna"}),a.authority==="Super Admin"&&e.jsx(Oe,{})]}),e.jsx(Ue,{})]})},Ze=Me;export{Ze as default};
