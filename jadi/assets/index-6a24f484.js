import{ai as I,aj as v,ak as z,al as E,u as h,j as e,r as m,a7 as R,a as O,L as H,i as P}from"./index-8f324225.js";import{b as F,f as $}from"./SubkontraktorService-d1deb94f.js";import{A as q}from"./AdaptableCard-54b628e2.js";import{D as B}from"./DataTable-66df47f9.js";import{t as M,N as K,I as G,H as J,J as f,K as Q,L as _,B as U,Q as V}from"./Views-a6cda74e.js";import{u as W}from"./useThemeClass-fe409b1f.js";import{C as X}from"./ConfirmDialog-cacab1ef.js";import{d as Y}from"./debounce-9aa8ee7b.js";import"./index-fee04496.js";const S="subkontraktorList",p=I(S+"/getSubkontraktors",async a=>{const t=await F(a);return{data:t.data.data,total:t.data.totaldataSubkon,totalPage:t.data.totalPage}}),Z=async a=>(await $(a)).data,tt={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},at={loading:!1,deleteConfirmation:!1,selectedSubkontraktor:"",subkontraktorList:[],tableData:tt,filterData:{name:"",category:["bags","cloths","devices","shoes","e"],status:[0,1,2],subkontraktorStatus:0}},D=v({name:`${S}/state`,initialState:at,reducers:{updateSubkontraktorList:(a,t)=>{a.subkontraktorList=t.payload},setTableData:(a,t)=>{a.tableData=t.payload},setFilterData:(a,t)=>{a.filterData=t.payload},toggleDeleteConfirmation:(a,t)=>{a.deleteConfirmation=t.payload},setSelectedSubkontraktor:(a,t)=>{a.selectedSubkontraktor=t.payload}},extraReducers:a=>{a.addCase(p.fulfilled,(t,o)=>{t.subkontraktorList=o.payload.data,t.tableData.total=o.payload.total,t.loading=!1}).addCase(p.pending,t=>{t.loading=!0})}}),{updateSubkontraktorList:St,setTableData:g,setFilterData:Dt,toggleDeleteConfirmation:x,setSelectedSubkontraktor:et}=D.actions,st=D.reducer,ot=z({data:st}),d=E,nt=()=>{const a=h(),t=d(l=>l.subkontraktorList.data.deleteConfirmation),o=d(l=>l.subkontraktorList.data.selectedSubkontraktor),u=d(l=>l.subkontraktorList.data.tableData),i=()=>{a(x(!1))},c=async()=>{a(x(!1)),await Z({id:o})&&(a(p(u)),M.push(e.jsx(K,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(X,{isOpen:t,type:"danger",title:"Hapus Subkontraktor",confirmButtonColor:"red-600",onClose:i,onRequestClose:i,onCancel:i,onConfirm:c,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus subkontraktor ini?"})})},rt=({row:a})=>{const t=h(),{textTheme:o}=W(),u=R(),i=()=>{u(`/master/subkontraktor-edit/${a.id}`)},c=()=>{t(x(!0)),t(et(a.id))};return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${o}`,onClick:i,children:e.jsx(G,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:c,children:e.jsx(J,{})})]})},it=()=>{const a=m.useRef(null),t=h(),o=d(s=>s.auth.user),{pageIndex:u,pageSize:i,sort:c,query:l,total:n}=d(s=>s.subkontraktorList.data.tableData),k=d(s=>s.subkontraktorList.data.filterData),j=d(s=>s.subkontraktorList.data.loading),y=d(s=>s.subkontraktorList.data.subkontraktorList);m.useEffect(()=>{C()},[u,i,c]),m.useEffect(()=>{var s;a&&((s=a.current)==null||s.resetSorting())},[k]);const b=m.useMemo(()=>({pageIndex:u,pageSize:i,sort:c,query:l,total:n}),[u,i,c,l,n]),C=()=>{t(p({pageIndex:u,pageSize:i,sort:c,query:l,filterData:k}))},L=m.useMemo(()=>{const s=[{header:"Nama",accessorKey:"nama",cell:r=>{const A=r.row.original;return e.jsx("span",{className:"capitalize",children:A.nama})}}];return(o==null?void 0:o.authority)!=="Admin"&&(o==null?void 0:o.authority)!=="Owner"&&s.push({header:"",id:"action",cell:r=>e.jsx(rt,{row:r.row.original})}),s},[o]),N=s=>{const r=f(b);r.pageIndex=s,t(g(r))},w=s=>{const r=f(b);r.pageSize=Number(s),r.pageIndex=1,t(g(r))},T=s=>{const r=f(b);r.sort=s,t(g(r))};return e.jsxs(e.Fragment,{children:[e.jsx(B,{ref:a,columns:L,data:y,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:j,pagingData:{total:b.total,pageIndex:b.pageIndex,pageSize:b.pageSize},onPaginationChange:N,onSelectChange:w,onSort:T}),e.jsx(nt,{})]})},lt=()=>{const a=h(),t=m.useRef(null),o=d(n=>n.subkontraktorList.data.tableData),u=Y(i,500);function i(n){const k=f(o);k.query=n,k.pageIndex=1,typeof n=="string"&&n.length>1&&c(k),typeof n=="string"&&n.length===0&&c(k)}const c=n=>{a(g(n)),a(p(n))},l=n=>{u(n.target.value)};return e.jsx(Q,{ref:t,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari subkontraktor",prefix:e.jsx(_,{className:"text-lg"}),onChange:l})},ct=()=>{const a=O(t=>t.auth.user);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(lt,{}),a.authority!=="Admin"&&a.authority!=="Owner"&&e.jsx(H,{className:"block lg:inline-block md:mb-0 mb-4 md:ml-2 ",to:"/master/subkontraktor-new",children:e.jsx(U,{block:!0,variant:"solid",size:"sm",icon:e.jsx(V,{}),children:"Tambah Subkontraktor"})})]})};P("subkontraktorList",ot);const ut=()=>e.jsxs(q,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Subkontraktor"}),e.jsx(ct,{})]}),e.jsx(it,{})]}),jt=ut;export{jt as default};
