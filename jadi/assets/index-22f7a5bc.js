import{ai as _,aj as q,ak as W,al as $,u as y,j as e,r as x,a7 as G,as as V,a as J,L as Q,i as X}from"./index-8f324225.js";import{a as Y,b as Z,c as v}from"./TenderService-e0c5ed39.js";import{A as ee}from"./AdaptableCard-54b628e2.js";import{D as ae}from"./DataTable-66df47f9.js";import{t as P,N as F,I as te,H as se,aX as ne,B as j,J as w,K as ie,L as re,P as le,F as O,R as S,w as oe,v as ce,k as de,Q as ue}from"./Views-a6cda74e.js";import{u as me}from"./useThemeClass-fe409b1f.js";import{C as I}from"./ConfirmDialog-cacab1ef.js";import{a as pe}from"./formatDate-07efb40a.js";import{d as he}from"./debounce-9aa8ee7b.js";import{F as ge,a as xe,b as R}from"./formik.esm-79e86e67.js";import"./index-fee04496.js";const A="tenderList",k=_(A+"/getTenders",async a=>{const t=await Y(a);return{data:t.data.data,total:t.data.totaldataTender,totalPage:t.data.totalPage}}),fe={total:0,pageIndex:1,pageSize:10,query:""},je={loading:!1,deleteConfirmation:!1,selectedTender:"",updateConfirmation:!1,tenderStatus:"",productList:[],tableData:fe,filterData:{status:""}},K=q({name:`${A}/state`,initialState:je,reducers:{setTableData:(a,t)=>{a.tableData=t.payload},setFilterData:(a,t)=>{a.filterData=t.payload},toggleDeleteConfirmation:(a,t)=>{a.deleteConfirmation=t.payload},setSelectedTender:(a,t)=>{a.selectedTender=t.payload},setUpdateConfirmation:(a,t)=>{a.updateConfirmation=t.payload},setTenderStatus:(a,t)=>{a.tenderStatus=t.payload}},extraReducers:a=>{a.addCase(k.fulfilled,(t,s)=>{t.productList=s.payload.data,t.tableData.total=s.payload.total,t.tableData.totalPage=s.payload.totalPage,t.loading=!1}).addCase(k.pending,t=>{t.loading=!0})}}),{setTableData:N,setFilterData:De,toggleDeleteConfirmation:L,setSelectedTender:E,setUpdateConfirmation:z,setTenderStatus:be}=K.actions,Ce=K.reducer,ke=W({data:Ce}),p=$,ye=()=>{const a=y(),t=p(o=>o.tenderList.data.deleteConfirmation),s=p(o=>o.tenderList.data.selectedTender),i=p(o=>o.tenderList.data.tableData),c=()=>{a(L(!1))},m=async()=>{a(L(!1)),await Z({id:s})&&(a(k(i)),P.push(e.jsx(F,{title:"Successfuly Deleted",type:"success",duration:2500,children:"Item berhasil dihapus"}),{placement:"top-center"}))};return e.jsx(I,{isOpen:t,type:"danger",title:"Hapus Tender",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:m,children:e.jsx("p",{children:"Apakah kamu yakin ingin menghapus tender ini?"})})},Te=()=>{const a=y(),t=p(n=>n.tenderList.data.updateConfirmation),s=p(n=>n.tenderList.data.selectedTender),i=p(n=>n.tenderList.data.tenderStatus),c=p(n=>n.tenderList.data.tableData),m=()=>{a(z(!1))},o=async()=>{a(z(!1));try{let n;i==="Diterima"?n=await v({id:s,status:i}):i==="Ditolak"?n=await v({id:s,status:i}):i==="Diproses"?n=await v({id:s,status:i}):i==="Batal"&&(n=await v({id:s,status:i})),n&&(a(k(c)),P.push(e.jsx(F,{title:"Successfuly Updated",type:"success",duration:2500,children:"Status berhasil di perbarui"}),{placement:"top-center"}))}catch(n){console.error("Error deleting notification:",n),P.push(e.jsx(F,{title:"Gagal Update Status Proyek",type:"danger",duration:2500,children:n.response.data.message}),{placement:"top-center"})}};return e.jsx(I,{isOpen:t,type:"warning",title:"Ubah Status",onConfirm:o,onCancel:m,onRequestClose:m,onClose:m,children:e.jsx("p",{children:"Apakah kamu yakin ingin mengupdate status tender ?"})})},ve=({row:a})=>{const t=y(),{textTheme:s}=me(),i=G(),c=()=>{i("/manajemen-proyek-new",{state:{idTender:a.id,pekerjaan:a.pekerjaan,nilai_kontrak:a.nilai_kontrak,idClient:a.idClient,idDivisi:a.idDivisi}})},m=()=>{i(`/manajemen-proyek/tender-edit/${a.id}`)},o=()=>{t(L(!0)),t(E(a.id))};return e.jsx("div",{className:"flex justify-end text-lg",children:a.status==="Pengajuan"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${s}`,onClick:m,children:e.jsx(te,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:o,children:e.jsx(se,{})})]}):a.status==="Diterima"?e.jsx("span",{className:`cursor-pointer p-2 hover:${s}`,onClick:c,children:e.jsx(ne,{})}):null})},Se=()=>{const a=x.useRef(null),t=y(),s=p(l=>l.auth.user),{pageIndex:i,pageSize:c,sort:m,query:o,total:n}=p(l=>l.tenderList.data.tableData),d=p(l=>l.tenderList.data.filterData),T=p(l=>l.tenderList.data.loading),b=p(l=>l.tenderList.data.productList);x.useEffect(()=>{C()},[i,c,m,d]),x.useEffect(()=>{var l;a&&((l=a.current)==null||l.resetSorting())},[d]);const h=x.useMemo(()=>({pageIndex:i,pageSize:c,sort:m,query:o,total:n}),[i,c,m,o,n]),C=()=>{t(k({page:i,limit:c,sort:m,query:o,filterData:d}))},f=async(l,r)=>{t(z(!0)),t(E(r)),t(be(l))},D=x.useMemo(()=>{const l=[{header:"Pekerjaan",accessorKey:"pekerjaan",minWidth:350,cell:r=>{const u=r.row.original;return e.jsx("span",{className:"capitalize",children:u.pekerjaan})}},{header:"Nilai Kontrak",accessorKey:"nilai_kontrak",minWidth:150,cell:r=>{const u=r.row.original;return e.jsxs("span",{className:"capitalize",children:["Rp ",u.nilai_kontrak.toLocaleString("id-ID")]})}},{header:"Klien",accessorKey:"client",minWidth:150,cell:r=>{const u=r.row.original;return e.jsx("span",{className:"capitalize",children:u.client})}},{header:"Divisi",accessorKey:"idDivisi",minWidth:150,cell:r=>{var g;const u=r.row.original;return e.jsx("span",{children:(g=u.Divisi)==null?void 0:g.name})}},{header:"Tgl. Pengajuan",accessorKey:"tanggal_pengajuan",minWidth:150,cell:r=>{const u=r.row.original;return e.jsx("span",{className:"capitalize",children:pe(u.tanggal_pengajuan)})}},{header:"Status",accessorKey:"status",minWidth:150,cell:r=>{const u=r.row.original;return e.jsx("span",{className:"capitalize",children:u.status==="Pengajuan"?e.jsxs("div",{className:"gap-2 flex flex-col",children:["Pengajuan",e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(j,{size:"xs",variant:"solid",disabled:(s==null?void 0:s.authority)==="Owner",onClick:g=>{f("Diproses",u.id),g.stopPropagation()},children:"Diproses"}),e.jsx(j,{size:"xs",variant:"solid",disabled:(s==null?void 0:s.authority)==="Owner",color:"gray-500",onClick:g=>{f("Batal",u.id),g.stopPropagation()},children:"Batal"})]})]}):u.status==="Diterima"?e.jsx("span",{className:"text-green-500",children:"Menang"}):u.status==="Ditolak"?e.jsx("span",{className:"text-rose-500",children:"Kalah"}):u.status==="Diproses"?e.jsxs("div",{className:"gap-2 flex flex-col",children:[e.jsx("span",{className:"text-indigo-500",children:"Diproses"})," ",e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(j,{size:"xs",variant:"solid",color:"green",disabled:(s==null?void 0:s.authority)==="Owner",onClick:g=>{f("Diterima",u.id),g.stopPropagation()},children:"Diterima"}),e.jsx(j,{size:"xs",variant:"solid",disabled:(s==null?void 0:s.authority)==="Owner",color:"rose",onClick:g=>{f("Ditolak",u.id),g.stopPropagation()},children:"Ditolak"}),e.jsx(j,{size:"xs",variant:"solid",disabled:(s==null?void 0:s.authority)==="Owner",color:"gray-500",onClick:g=>{f("Batal",u.id),g.stopPropagation()},children:"Batal"})]})]}):e.jsx("span",{className:"text-gray-500",children:u.status})})}}];return(s==null?void 0:s.authority)!=="Owner"&&l.push({header:"",id:"action",cell:r=>e.jsx(ve,{row:r.row.original})}),l},[s]),H=l=>{const r=w(h);r.pageIndex=l,t(N(r))},U=l=>{const r=w(h);r.pageSize=Number(l),r.pageIndex=1,t(N(r))},M=l=>{const r=w(h);r.sort=l,t(N(r))};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{ref:a,columns:D,data:b,skeletonAvatarColumns:[0],skeletonAvatarProps:{className:"rounded-md"},loading:T,pagingData:{total:h.total,pageIndex:h.pageIndex,pageSize:h.pageSize,totalPage:h.totalPage},onPaginationChange:H,onSelectChange:U,onSort:M}),e.jsx(ye,{}),e.jsx(Te,{})]})},we=()=>{const a=y(),t=x.useRef(null),s=p(n=>n.tenderList.data.tableData),i=he(c,500);function c(n){const d=w(s);d.query=n,d.pageIndex=1,typeof n=="string"&&n.length>1&&m(d),typeof n=="string"&&n.length===0&&m(d)}const m=n=>{a(N(n)),a(k(n))},o=n=>{i(n.target.value)};return e.jsx(ie,{ref:t,className:"max-w-md md:w-52 md:mb-0 mb-4",size:"sm",placeholder:"Cari tender",prefix:e.jsx(re,{className:"text-lg"}),onChange:o})},B=x.forwardRef(({onSubmitComplete:a},t)=>{const s=y(),{selectDivisi:i,loadingSelectDivisi:c}=p(d=>d.base.common),m=p(d=>d.tenderList.data.filterData),o=x.useMemo(()=>i!=null&&i.data?i.data.map(d=>({value:d.id,label:d.name})):[],[i]),n=d=>{a==null||a(),s(De(d))};return x.useEffect(()=>{s(V())},[]),e.jsx(ge,{enableReinitialize:!0,innerRef:t,initialValues:m,onSubmit:d=>{n(d)},children:({values:d,touched:T,errors:b})=>e.jsx(xe,{children:e.jsxs(le,{children:[e.jsxs(O,{invalid:b.status&&T.status,errorMessage:b.status,children:[e.jsx("h6",{className:"mb-4",children:"Tender Status"}),e.jsx(R,{name:"status",children:({field:h,form:C})=>e.jsxs(S.Group,{vertical:!0,value:d.status,onChange:f=>C.setFieldValue(h.name,f),children:[e.jsx(S,{value:"Pengajuan",children:"Pengajuan"}),e.jsx(S,{value:"Diterima",children:"Diterima"}),e.jsx(S,{value:"Ditolak",children:"Ditolak"})]})})]}),e.jsx(O,{label:"Klien",invalid:b.idDivisi&&T.idDivisi,errorMessage:b.idDivisi,children:e.jsx(R,{name:"idDivisi",children:({field:h,form:C})=>{const f=h.value?o.find(D=>D.value===h.value):null;return e.jsx(oe,{field:h,form:C,options:o,isLoading:c,value:f||null,placeholder:"Pilih divisi",onChange:D=>{C.setFieldValue(h.name,D==null?void 0:D.value)}})}})})]})})})}),Ne=({onSaveClick:a,onCancel:t})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(j,{size:"sm",className:"mr-2",onClick:t,children:"Cancel"}),e.jsx(j,{size:"sm",variant:"solid",onClick:a,children:"Terapkan"})]}),Pe=()=>{const a=x.useRef(null),[t,s]=x.useState(!1),i=()=>{s(!0)},c=()=>{s(!1)},m=()=>{var o;(o=a.current)==null||o.submitForm()};return e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm",className:"block md:inline-block ltr:md:ml-2 rtl:md:mr-2 md:mb-0 mb-4",icon:e.jsx(ce,{}),onClick:()=>i(),children:"Filter"}),e.jsx(de,{title:"Filter",isOpen:t,footer:e.jsx(Ne,{onCancel:c,onSaveClick:m}),onClose:c,onRequestClose:c,children:e.jsx(B,{ref:a,onSubmitComplete:c})})]})};B.displayName="FilterForm";const Fe=()=>{const a=J(t=>t.auth.user);return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center",children:[e.jsx(we,{}),e.jsx(Pe,{}),a.authority!=="Owner"&&e.jsx(Q,{className:"block lg:inline-block md:mb-0 mb-4 ml-2",to:"/manajemen-proyek/tender-new",children:e.jsx(j,{block:!0,variant:"solid",size:"sm",icon:e.jsx(ue,{}),children:"Tambah Tender"})})]})};X("tenderList",ke);const Le=()=>e.jsxs(ee,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Daftar Tender"}),e.jsx(Fe,{})]}),e.jsx(Se,{})]}),_e=Le;export{_e as default};
